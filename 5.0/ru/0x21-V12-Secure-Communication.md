# V12 Безопасная коммуникация

## Задачи контроля

В этой главе изложены требования, связанные с механизмами защиты данных при передаче, как между клиентом конечного пользователя и серверной частью, так и между компонентами внутренней сервисной архитектуры.

Основные концепции главы:

* Шифрование внешних коммуникаций, а в идеале — и внутри системы.
* Настройку механизмов шифрования в соответствии с актуальными рекомендациями, включая предпочтительные алгоритмы и шифры.
* Использование подписанных сертификатов для защиты от перехвата данных третьими лицами.

Кроме того, помимо общих принципов и лучших практик, ASVS предоставляет более глубокую техническую информацию о криптографической стойкости в Приложении C - Стандарты криптографии.

## V12.1 Общие рекомендации по безопасности TLS

В этом разделе приводятся первоначальные рекомендации по обеспечению безопасности TLS-соединений. Для постоянного контроля конфигурации TLS следует использовать актуальные инструменты.

Хотя использование универсальных (wildcard) TLS-сертификатов само по себе не является небезопасным, компрометация такого сертификата, который используется во всех управляемых окружениях (например, в production, staging, development, test), может привести к нарушению безопасности приложений, использующих этот сертификат. Поэтому при возможности рекомендуется применять надёжную защиту, управление и использовать отдельные TLS-сертификаты для разных сред.

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **12.1.1** | Убедитесь, что включены только актуальные и рекомендуемые версии протокола TLS, такие как TLS 1.2 и TLS 1.3. Наиболее свежая версия TLS должна быть выбрана как предпочтительная. | 1 |
| **12.1.2** | Убедитесь, что включены рекомендуемые шифронаборы (cipher suites), предпочтение также стоит отдать самому сильному шифронабору. L3 приложения должны поддерживать только те наборы шифров (cipher suites), которые обеспечивают прямую (forward) секретность. Пояснение: Прямая секретность (Forward Secrecy, FS) — это криптографическая особенность, при которой сессионные ключи уникальны для каждой сессии и не зависят от долгосрочных ключей. Это гарантирует, что даже при компрометации долгосрочного ключа злоумышленник не сможет расшифровать ранее перехваченные зашифрованные сессии. | 2 |
| **12.1.3** | Убедитесь, что приложение проверяет доверенность клиентских сертификатов mTLS, прежде чем использовать идентификацию по сертификату для аутентификации или авторизации. | 2 |
| **12.1.4** | Убедитесь, что включена и настроена правильная проверка отзыва сертификатов, такая как Online Certificate Status Protocol (OCSP) Stapling. | 3 |
| **12.1.5** | Убедитесь, что в настройках TLS приложения включена функция Encrypted Client Hello (ECH) для предотвращения раскрытия конфиденциальных метаданных, таких как Server Name Indication (SNI), во время процесса TLS-рукопожатия. | 3 |

## V12.2 HTTPS коммуникация с внешними сервисами

Убедитесь, что весь HTTP-трафик к внешним сервисам, которые предоставляет приложение, передавался в зашифрованном виде с использованием публично доверенных сертификатов.

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **12.2.1** | Убедитесь, что для всех соединений между клиентом и внешними HTTP-сервисами используется TLS и не происходит отката к небезопасным или незашифрованным протоколам. | 1 |
| **12.2.2** | Убедитесь, что внешние сервисы используют публично доверенные TLS-сертификаты. | 1 |

## V12.3 Общая безопасность межсервисного взаимодействия

Все взаимодействия между серверами (включая внутренние и внешние подключения) должны быть защищены, предпочтительно с применением TLS-шифрования. Соединения с другими системами также должны быть защищены, желательно с использованием TLS.

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **12.3.1** | Убедитесь, что для всех входящих и исходящих соединений приложения используется зашифрованный протокол, например TLS, включая системы мониторинга, инструменты управления, удалённый доступ и SSH, промежуточное ПО, базы данных, мейнфреймы, партнёрские системы и внешние API. Сервер не должен допускать откат к небезопасным или незашифрованным протоколам. | 2 |
| **12.3.2** | Убедитесь, что TLS-клиент проверяет сертификат сервера до установления защищенного соединения с TLS-сервером. | 2 |
| **12.3.3** | Убедитесь, что все внутренние HTTP-взаимодействия между компонентами приложения используют TLS или другой подходящий механизм транспортного шифрования, и не происходит откат к небезопасным или незашифрованным коммуникациям. | 2 |
| **12.3.4** | Убедитесь, что TLS-соединения между внутренними сервисами используют доверенные сертификаты. Если используются внутренние или самоподписанные сертификаты, потребляющий сервис должен быть настроен на доверие только к конкретным внутренним центрам сертификации (CA) и конкретным самоподписанным сертификатам. | 2 |
| **12.3.5** | Убедитесь, что сервисы, взаимодействующие внутри системы (intra-service communications), используют строгую аутентификацию для проверки каждого конечного узла. Для проверки подлинности взаимодействующих сторон должны применяться методы строгой аутентификации, такие как аутентификация TLS-клиента, с использованием инфраструктуры открытых ключей и механизмов, устойчивых к атакам повтора (replay attacks). Для микросервисных архитектур рекомендуется использование service mesh для упрощения управления сертификатами и повышения безопасности. | 3 |

## Ссылки

Для дополнительной информации см. также:

* [OWASP - Transport Layer Security Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Security_Cheat_Sheet.html)
* [Mozilla's Server Side TLS configuration guide](https://wiki.mozilla.org/Security/Server_Side_TLS)
* [Mozilla's tool to generate known good TLS configurations](https://ssl-config.mozilla.org/).
* [O-Saft - OWASP Project to validate TLS configuration](https://owasp.org/www-project-o-saft/)
