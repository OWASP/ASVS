# V6 Аутентификация

## Цель контроля

Аутентификация — это процесс установления или подтверждения подлинности личности или устройства. Он включает в себя проверку заявленных данных, устойчивость к подмене личности и защиту от перехвата или восстановления паролей.

[Документ NIST SP 800-63](https://pages.nist.gov/800-63-3/) является современным и основанным на фактических данных стандартом, особенно актуальным для государственных структур США и организаций, взаимодействующих с ними.

Хотя многие требования этой главы основаны на разделе NIST SP 800-63B ("Руководство по цифровой идентификации — Управление аутентификацией и жизненным циклом"), акцент сделан на распространённых угрозах и часто эксплуатируемых слабостях. Эта глава не охватывает весь стандарт. Для полной реализации NIST SP 800-63 необходимо обратиться к оригиналу.

В тексте используется более понятная терминология, отличающаяся от формулировок NIST.

Многие современные приложения адаптируют этапы аутентификации в зависимости от уровня риска. Эти механизмы рассматриваются в главе «Авторизация», поскольку они также касаются авторизационных решений.

## V6.1 Документация по аутентификации

Этот раздел содержит требования к документации по аутентификации, которую необходимо вести для приложения. Это критически важно для того, чтобы правильно настроить и оценить соответствующие механизмы управления аутентификацией.

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **6.1.1** | Убедитесь, что в документации приложения описано, как используются механизмы, такие как ограничение частоты запросов (rate limiting), защита от автоматизации и адаптивные реакции, для защиты от атак, таких как подстановка учётных данных и перебор паролей. Документация должна ясно описывать конфигурацию этих механизмов и предотвращение злонамеренной блокировки аккаунтов. | 1 |
| **6.1.2** | Убедитесь, что задокументирован список контекстно-зависимых слов, запрещённых к использованию в паролях. В него могут входить производные от названий организаций, продуктов, идентификаторов систем, кодовых названий проектов, названий отделов или ролей и тому подобное. | 2 |
| **6.1.3** | Убедитесь, что задокументирован список контекстно-зависимых слов, запрещённых к использованию в паролях. В него могут входить производные от названий организаций, продуктов, идентификаторов систем, кодовых названий проектов, названий отделов или ролей и тому подобное. | 2 |

## V6.2 Безопасность паролей

Пароли (в терминологии NIST SP 800-63 — «запоминаемые секреты») включают в себя пароли, кодовые фразы, PIN-коды, графические шаблоны разблокировки и, например, выбор нужного котёнка или другого элемента на изображении. Они относятся к категории «что-то, что вам известно» и часто используются как однофакторный механизм аутентификации.

Соответственно, в этом разделе перечислены требования, направленные на безопасное создание и обработку паролей. Большинство требований относятся к уровню L1, поскольку на этом уровне они наиболее важны. Начиная с уровня L2, требуется использование многофакторной аутентификации, в которой пароли могут быть одним из факторов.

Требования в данном разделе в основном соответствуют [&sect; 5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) [руководства NIST](https://pages.nist.gov/800-63-3/sp800-63b.html).

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **6.2.1** | Убедитесь, что пользовательские пароли содержат не менее 8 символов. Рекомендуется минимальная длина в 15 символов. | 1 |
| **6.2.2** | Убедитесь, что пользователи могут менять свои пароли. | 1 |
| **6.2.3** | Убедитесь, что для смены пароля требуется ввести как текущий, так и новый пароль. | 1 |
| **6.2.4** | Убедитесь, что при регистрации или смене пароля введённый пароль проверяется по списку как минимум из 3000 самых популярных паролей, соответствующих политике (например, минимальной длине). | 1 |
| **6.2.5** | Убедитесь, что допускаются пароли любой структуры, без ограничений на использование определённых символов. Не должно быть требований по обязательному наличию заглавных/строчных букв, цифр или специальных символов. | 1 |
| **6.2.6** | Убедитесь, что поля ввода пароля используют type=password для скрытия символов. Разрешено временное отображение всего пароля или последнего введённого символа. | 1 |
| **6.2.7** | Убедитесь, что разрешены вставка (paste), использование менеджеров паролей браузера и внешних менеджеров паролей. | 1 |
| **6.2.8** | Убедитесь, что пароль проверяется строго в том виде, в котором он был введён пользователем — без обрезки, изменения регистра и других модификаций. | 1 |
| **6.2.9** | Убедитесь, что система позволяет использовать пароли длиной не менее 64 символов. | 2 |
| **6.2.10** | Убедитесь, что пароль остаётся действительным, пока не будет скомпрометирован или не будет изменён пользователем. Приложение не должно требовать регулярной смены пароля. | 2 |
| **6.2.11** | Убедитесь, что используется документированный список контекстно-зависимых слов (например, названия компаний, проектов и т.д.) для предотвращения использования легко угадываемых паролей. | 2 |
| **6.2.12** | Убедитесь, что при регистрации или смене пароля проверяется, не входит ли он в список скомпрометированных (утёкших) паролей. | 2 |

## V6.3 Общие требования к безопасности аутентификации

В этом разделе изложены общие требования к безопасности механизмов аутентификации, а также различные ожидания для разных уровней защиты. Для приложений уровня L2 обязательно использование многофакторной аутентификации (MFA). Для приложений уровня L3 требуется аппаратная аутентификация, выполняемая в аттестованной и доверенной среде исполнения (TEE). Это может включать: ключи passkey, привязанные к устройству; аутентификаторы, соответствующие eIDAS LoA High; аутентификаторы с уровнем доверия NIST AAL3; или эквивалентные механизмы.

Это достаточно строгий подход к MFA, но он необходим для повышения уровня защиты пользователей. Любое смягчение этих требований должно сопровождаться документированным обоснованием и чётким планом по смягчению рисков с учётом рекомендаций и исследований NIST.

Обратите внимание: на момент публикации NIST SP 800-63 рассматривает email как [недопустимый](https://pages.nist.gov/800-63-FAQ/#q-b11) механизм аутентификации ([archived copy](https://web.archive.org/web/20250330115328/https://pages.nist.gov/800-63-FAQ/#q-b11)).

Требования в этом разделе опираются на следующие части [руководства NIST](https://pages.nist.gov/800-63-3/sp800-63b.html), including: [&sect; 4.2.1](https://pages.nist.gov/800-63-3/sp800-63b.html#421-permitted-authenticator-types), [&sect; 4.3.1](https://pages.nist.gov/800-63-3/sp800-63b.html#431-permitted-authenticator-types), [&sect; 5.2.2](https://pages.nist.gov/800-63-3/sp800-63b.html#522-rate-limiting-throttling), и [&sect; 6.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#-612-post-enrollment-binding).

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **6.3.1** | Убедитесь, что реализованы меры защиты от атак типа credential stuffing (массовая подстановка учётных данных) и brute-force (перебор паролей), согласно документации по безопасности приложения. | 1 |
| **6.3.2** | Убедитесь, что в приложении отсутствуют или отключены учётные записи по умолчанию (например, root, admin, sa). | 1 |
| **6.3.3** | Убедитесь, что для доступа к приложению используется либо механизм многофакторной аутентификации, либо комбинация однофакторных. Для уровня L3 один из факторов должен быть аппаратным, обеспечивающим защиту от фишинга, устойчивость к компрометации и подтверждение намерения аутентификации через явное действие пользователя (например, нажатие кнопки на FIDO-ключе или телефоне). Ослабление этих требований допускается только при наличии обоснования и компенсирующих мер. | 2 |
| **6.3.4** | Убедитесь, что при наличии нескольких путей аутентификации, они все задокументированы, и для них единообразно применяются меры защиты и уровни доверия. | 2 |
| **6.3.5** | Убедитесь, что пользователи получают уведомления о подозрительных попытках аутентификации (удачных и неудачных). Это может включать попытки (например, подключения) с необычного устройства или места, частично успешную MFA, попытку после долгого отсутствия или успешную аутентификацию после серии неудачных. | 3 |
| **6.3.6** | Убедитесь, что email не используется ни как однофакторный, ни как многофакторный механизм аутентификации. | 3 |
| **6.3.7** | Убедитесь, что пользователи получают уведомление при изменении данных аутентификации, таких как сброс пароля или изменение логина/email. | 3 |
| **6.3.8** | Убедитесь, что из сообщений об ошибке, HTTP-кодов ответа или различий во времени ответа нельзя определить, существует ли пользователь с таким логином. Это правило также должно применяться к функциям регистрации и восстановления пароля. | 3 |

## V6.4 Жизненный цикл и восстановление факторов аутентификации

Факторы аутентификации могут включать пароли, программные токены (soft tokens), аппаратные токены (hardware tokens) и биометрические устройства. Безопасное управление жизненным циклом этих механизмов критически важно для безопасности приложения, и данный раздел включает соответствующие требования.

Требования в этом разделе в основном соответствуют разделам [&sect; 5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) или [&sect; 6.1.2.3](https://pages.nist.gov/800-63-3/sp800-63b.html#replacement) [руководства NIST](https://pages.nist.gov/800-63-3/sp800-63b.html).

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **6.4.1** | Убедитесь, что начальные пароли или коды активации, генерируемые системой, создаются с использованием надёжного генератора случайных чисел, соответствуют текущей политике паролей и истекают через короткий период времени либо после первого использования. Эти секреты не должны использоваться как постоянные пароли. | 1 |
| **6.4.2** | Убедитесь, что в системе отсутствуют подсказки к паролю или вопросы на знание ("секретные вопросы"). | 1 |
| **6.4.3** | Убедитесь, что реализован безопасный процесс сброса забытого пароля, который не обходит активные механизмы многофакторной аутентификации. | 2 |
| **6.4.4** | Убедитесь, что реализован безопасный процесс сброса забытого пароля, который не обходит активные механизмы многофакторной аутентификации. | 2 |
| **6.4.5** | Убедитесь, что инструкции по обновлению истекающих механизмов аутентификации отправляются заранее, с достаточным запасом времени для выполнения замены, при необходимости с настройкой автоматических напоминаний. | 3 |
| **6.4.6** | Убедитесь, что администраторы могут инициировать процесс сброса пароля, но не могут задать или выбрать новый пароль за пользователя. Это исключает ситуацию, при которой администратор знает пароль пользователя. | 3 |

## V6.5 Общие требования к многофакторной аутентификации

Этот раздел содержит общие рекомендации, применимые к различным методам многофакторной аутентификации (MFA).

К таким механизмам относятся:

* Lookup-секреты
* Временные одноразовые пароли (TOTP)
* Out-of-Band (внеполосные) механизмы

Lookup-секреты — заранее сгенерированные списки одноразовых кодов, аналогичные TAN-кодам (Transaction Authorization Numbers), кодам восстановления для соцсетей или таблицам с наборами случайных значений. Эти коды считаются фактором типа «что-то, что у вас есть», поскольку они не запоминаются и должны быть где-то сохранены.

Временные одноразовые пароли (TOTP) — аппаратные или программные токены, генерирующие постоянно меняющиеся псевдослучайные коды. Это также фактор типа «что-то, что у вас есть». MFA-варианты TOTP предполагают дополнительное подтверждение — например, PIN-код, биометрию, вставку USB-ключа, NFC или дополнительные значения (например, калькуляторы для подписания транзакций).

Out-of-Band (внеполосные) механизмы рассматриваются в следующем разделе.

Требования этого раздела в основном соответствуют [&sect; 5.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#-512-look-up-secrets), [&sect; 5.1.3](https://pages.nist.gov/800-63-3/sp800-63b.html#-513-out-of-band-devices), [&sect; 5.1.4.2](https://pages.nist.gov/800-63-3/sp800-63b.html#5142-single-factor-otp-verifiers), [&sect; 5.1.5.2](https://pages.nist.gov/800-63-3/sp800-63b.html#5152-multi-factor-otp-verifiers), [&sect; 5.2.1](https://pages.nist.gov/800-63-3/sp800-63b.html#521-physical-authenticators), и [&sect; 5.2.3](https://pages.nist.gov/800-63-3/sp800-63b.html#523-use-of-biometrics) [руководства NIST](https://pages.nist.gov/800-63-3/sp800-63b.html).

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **6.5.1** | Убедитесь, что lookup-секреты, внеполосные коды/запросы и TOTP-коды можно использовать только один раз. | 2 |
| **6.5.2** | Убедитесь, что при хранении lookup-секретов с энтропией менее 112 бит (например, 19 случайных буквенно-цифровых символов или 34 случайные цифры) они хэшируются с использованием разрешённого алгоритма хеширования паролей и случайной соли минимум 32 бита. Если у секрета ≥112 бит энтропии — допустимо использовать стандартный хэш. | 2 |
| **6.5.3** | Убедитесь, что lookup-секреты, коды внеполосной аутентификации и сиды для TOTP генерируются с использованием криптографически стойкого генератора случайных чисел (CSPRNG), чтобы избежать предсказуемых значений. | 2 |
| **6.5.4** | Убедитесь, что lookup-секреты и внеполосные коды аутентификации имеют минимум 20 бит энтропии (достаточно, например, 4 случайных алфавитно-цифровых символов или 6 случайных цифр). | 2 |
| **6.5.5** | Убедитесь, что все внеполосные запросы, коды и токены, а также TOTP-коды имеют ограниченный срок действия. Максимум для out-of-band — 10 минут, для TOTP — 30 секунд. | 2 |
| **6.5.6** | Убедитесь, что любой фактор аутентификации (включая физические устройства) может быть отозван в случае кражи или утери. | 3 |
| **6.5.7** | Убедитесь, что биометрические механизмы аутентификации используются только как вторичный фактор — в сочетании с «чем-то, что вы знаете» или «чем-то, что у вас есть». | 3 |
| **6.5.8** | Убедитесь, что TOTP-коды проверяются по источнику времени, полученному от доверенного сервиса, а не от клиента или недоверенного источника. | 3 |

## V6.6 Внеполосные механизмы аутентификации

Обычно внеполосная аутентификация предполагает, что сервер аутентификации взаимодействует с физическим устройством пользователя через безопасный вторичный канал. Например, путём отправки push-уведомления на мобильное устройство. Такой механизм считается фактором типа «что-то, что у вас есть».

Небезопасные внеполосные методы аутентификации, такие как электронная почта и VOIP, не допускаются. Аутентификация через PSTN и SMS в настоящее время [считается ограниченной](https://pages.nist.gov/800-63-FAQ/#q-b01) по версии NIST и должна постепенно заменяться на временные одноразовые пароли (TOTP), криптографические механизмы или аналогичные средства. Руководство NIST SP 800-63B [&sect; 5.1.3.3](https://pages.nist.gov/800-63-3/sp800-63b.html#-5133-authentication-using-the-public-switched-telephone-network) рекомендует принимать меры против таких угроз, как замена устройства, смена SIM-карты, перенос номера и прочие аномалии, если всё же приходится использовать телефонную или SMS-аутентификацию. Хотя этот раздел ASVS не требует строго выполнять эти рекомендации, их игнорирование для чувствительных приложений уровня L2 или L3 считается серьёзным сигналом риска.

Также стоит отметить, что NIST недавно выпустил рекомендации, в которых отговаривает от [использования push-уведомлений](https://pages.nist.gov/800-63-4/sp800-63b/authenticators/#fig-3). Хотя ASVS пока этого не запрещает, важно учитывать риск push-бомбинга (массовой отправки уведомлений для перегрузки пользователя).

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **6.6.1** | Убедитесь, что механизмы аутентификации через телефонную сеть общего пользования (PSTN) для доставки одноразовых паролей (OTP) по телефону или SMS используются только в случае предварительной валидации номера, при этом предлагаются альтернативные более безопасные методы (например, TOTP), и пользователю сообщаются риски. Для приложений уровня L3 использование телефона и SMS недопустимо. | 2 |
| **6.6.2** | Убедитесь, что внеполосные запросы, коды или токены привязаны к исходному запросу аутентификации, для которого они были сгенерированы, и не могут быть использованы повторно для других попыток. | 2 |
| **6.6.3** | Убедитесь, что внеполосные механизмы на основе кода защищены от атак методом подбора (brute force) путём применения ограничения частоты запросов (rate limiting). Также рекомендуется использовать коды с энтропией не менее 64 бит. | 2 |
| **6.6.4** | Убедитесь, что при использовании push-уведомлений для MFA применяется ограничение частоты (rate limiting), чтобы предотвратить атаки push-бомбинга. Также может помочь механизм сопоставления номеров (number matching). | 3 |

## V6.7 Криптографические механизмы аутентификации

Криптографические механизмы аутентификации включают, например, смарт-карты или ключи FIDO, при использовании которых пользователь должен подключить или сопрячь криптографическое устройство с компьютером для завершения аутентификации. Аутентификационный сервер отправляет случайную строку (nonce) на криптографическое устройство или программное обеспечение, и устройство или программа вычисляет ответ на основе надежно хранимого криптографического ключа. Требования в этом разделе содержат рекомендации по реализации подобных механизмов. Рекомендации по выбору криптографических алгоритмов приведены в главе «Криптография».

Если для криптографической аутентификации используются общие или секретные ключи, они должны храниться с использованием тех же механизмов, что и другие системные секреты — как указано в разделе «Управление секретами» главы «Конфигурация».

Требования этого раздела в основном соответствуют пункту [&sect; 5.1.7.2](https://pages.nist.gov/800-63-3/sp800-63b.html#sfcdv) [руководства NIST](https://pages.nist.gov/800-63-3/sp800-63b.html).

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **6.7.1** | Убедитесь, что сертификаты, используемые для проверки криптографических утверждений об аутентификации, хранятся таким образом, чтобы исключить возможность их модификации. | 3 |
| **6.7.2** | Убедитесь, что nonce (случайная строка), используемая в процессе вызова, имеет длину не менее 64 бит и является статистически уникальной или уникальной на протяжении всего срока службы криптографического устройства. | 3 |

## V6.8 Аутентификация с использованием провайдера идентификаций (IdP)

Провайдеры идентификаций (IdP) предоставляют пользователям федеративную идентификацию. У одного пользователя может быть несколько различных идентификаторов через разные IdP, например, корпоративная учётная запись через Azure AD, Okta, Ping Identity или Google, а также потребительская через Facebook, Twitter, Google или WeChat. Этот перечень не является рекламой данных сервисов, а лишь отражает реальность: у многих пользователей есть уже существующие идентификации. Организациям стоит учитывать возможность интеграции с такими внешними IdP в зависимости от уровня доверия к процедурам подтверждения личности у этих провайдеров. Например, государственная система вряд ли примет соцсети в качестве логина, так как там легко создать фальшивую учётную запись, а вот мобильной игре может быть полезна авторизация через соцсети для роста пользовательской базы.

Безопасное использование внешних IdP требует тщательной настройки и проверки, чтобы не допустить подделки личности или ложных утверждений (assertions). Данный раздел описывает требования, направленные на снижение этих рисков.

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **6.8.1** | Убедитесь, что при поддержке несколькими IdP, невозможно подделать личность пользователя через другой IdP (например, с тем же user ID). Стандартным способом защиты является регистрация пользователя с использованием сочетания ID самого IdP (в качестве пространства имён) и пользовательского ID внутри IdP. | 2 |
| **6.8.2** | Убедитесь, что наличие и целостность цифровой подписи в утверждениях аутентификации (например, в JWT или SAML) всегда проверяются, а неподписанные или недействительные утверждения отклоняются. | 2 |
| **6.8.3** | Убедитесь, что SAML-утверждения обрабатываются только один раз в течение периода их действия, чтобы исключить атаки воспроизведения (replay attacks). | 2 |
| **6.8.4** | Убедитесь, что если приложение использует внешний поставщик идентификации (IdP) и для определенных функций требуется особый уровень, метод или срок действия аутентификации, то приложение использует данные, возвращаемые IdP, для проверки этих условий. Например, при использовании OIDC можно проверить значения полей ID Token — acr, amr, auth_time (если они есть). Если IdP не предоставляет эти данные, приложение должно иметь документированный план действий по умолчанию, предполагающий использование минимально допустимой силы аутентификации (например, одноступенчатая — логин и пароль). | 2 |

## Ссылки

Подробнее:

* [NIST SP 800-63 - Digital Identity Guidelines](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63-3.pdf)
* [NIST SP 800-63B - Authentication and Lifecycle Management](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63b.pdf)
* [NIST SP 800-63 FAQ](https://pages.nist.gov/800-63-FAQ/)
* [OWASP Web Security Testing Guide: Testing for Authentication](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/04-Authentication_Testing)
* [OWASP Password Storage Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html)
* [OWASP Forgot Password Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Forgot_Password_Cheat_Sheet.html)
* [OWASP Choosing and Using Security Questions Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Choosing_and_Using_Security_Questions_Cheat_Sheet.html)
* [CISA Guidance on "Number Matching"](https://www.cisa.gov/sites/default/files/publications/fact-sheet-implement-number-matching-in-mfa-applications-508c.pdf)
* [Details on the FIDO Alliance](https://fidoalliance.org/)
