# V17 WebRTC

## Цель контроля

Web Real-Time Communication (WebRTC) — технология, обеспечивающая передачу голоса, видео и данных в реальном времени в современных приложениях. По мере роста WebRTC обеспечение безопасности инфраструктуры WebRTC становится критически важным. В данном разделе представлены требования по безопасности для разработчиков, хостинг-провайдеров и интеграторов решений на основе WebRTC.

Рынок WebRTC можно разделить на три основных сегмента:

1. Разработчики продуктов  — поставщики, создающие и поставляющие продукты и решения WebRTC как с собственным, так и с открытым исходным кодом. Они специализируются на разработке надежных и безопасных технологий WebRTC, которые могут использоваться другими.

2. Платформы коммуникаций как услуга (CPaaS) — провайдеры, предлагающие API, SDK и инфраструктуру для реализации WebRTC-функциональности. Они могут использовать продукты первой категории или разрабатывать собственное ПО WebRTC для предоставления этих услуг.

3. Поставщики услуг — организации, внедряющие WebRTC-решения (на базе готовых продуктов или собственных разработок) для создания приложений для онлайн-конференций, здравоохранения, электронного обучения и других областей, где критически важна коммуникация в режиме реального времени.

Изложенные здесь требования безопасности в первую очередь ориентированы на разработчиков продуктов, CPaaS-провайдеров, поставщиков услуг, которые:

* Используют open-source решения для создания своих WebRTC-приложений.
* Применяют коммерческие WebRTC-продукты как часть своей инфраструктуры.
* Разрабатывают собственные WebRTC-решения или интегрируют различные компоненты в единый сервис.

Важно отметить, что эти требования безопасности не распространяются на разработчиков, использующих исключительно SDK и API, предоставляемые поставщиками CPaaS. Для таких разработчиков CPaaS-провайдеры обычно несут ответственность за обеспечение базовой безопасности своей платформы, и универсальные стандарты безопасности (например, ASVS) могут не полностью покрывать их потребности.

## V17.1 TURN-сервер

В этом разделе определяются требования безопасности для систем, использующих собственные серверы TURN (Traversal Using Relays around NAT). Серверы TURN помогают ретранслировать медиаданные в сетевых средах с ограничениями, но могут представлять опасность при неправильной настройке. Эти меры контроля направлены на безопасную фильтрацию адресов и защиту от исчерпания ресурсов.

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **17.1.1** | Убедитесь, что сервис TURN (Traversal Using Relays around NAT) разрешает доступ только к IP-адресам, не зарезервированным для специальных целей (например, внутренние сети, широковещательная рассылка, loopback-адреса). Данное требование применяется как к IPv4, так и к IPv6 адресам. | 2 |
| **17.1.2** | Убедитесь, что сервис TURN (Traversal Using Relays around NAT) защищен от исчерпания ресурсов при попытках легитимных пользователей открыть чрезмерное количество портов на сервере. | 3 |

## V17.2 Требования к медиасерверам

Данные требования применяются только к системам, использующим собственные WebRTC-медиасерверы, такие как, SFU (Selective Forwarding Units), MCU (Multipoint Control Units), серверы записи, шлюзовые серверы. Медиасерверы обрабатывают и распределяют медиапотоки, поэтому их безопасность критически важна для защиты взаимодействия между участниками. Обеспечение безопасности медиапотоков в WebRTC-приложениях является приоритетной задачей для предотвращения перехвата данных, манипуляций с трафиком, атак типа "отказ в обслуживании". Эти угрозы могут нарушить конфиденциальность пользователей и качество связи.

В частности, необходимо реализовать защиту от флуд-атак, включая: ограничение частоты запросов (rate limiting), проверку временных меток, использование синхронизированных часов для контроля временных интервалов и управление буферами для предотвращения переполнения и поддержания правильной временной синхронизации. Если пакеты для конкретного медиасеанса прибывают слишком быстро, избыточные пакеты должны отбрасываться. Также важно защитить систему от некорректных пакетов путем валидации входных данных, безопасной обработки целочисленных переполнений, предотвращения переполнения буферов и применения других надежных методов обработки ошибок.

Системы, использующие исключительно peer-to-peer медиакоммуникацию между веб-браузерами без промежуточных медиасерверов, не подпадают под эти специфические требования к медиабезопасности.

Данный раздел относится к использованию Datagram Transport Layer Security (DTLS) в контексте WebRTC. Требования к документированной политике управления криптографическими ключами приведены в главе "Криптография". Информацию об одобренных криптографических методах можно найти в Приложении С "Криптография" ASVS или в таких документах, как NIST SP 800-52 Rev. 2 или BSI TR-02102-2 (версия 2025-01).

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **17.2.1** | Убедитесь, что ключ сертификата Datagram Transport Layer Security (DTLS) управляется и защищается в соответствии с документированной политикой управления криптографическими ключами. | 2 |
| **17.2.2** | Убедитесь, что медиасервер настроен на использование только одобренных наборов шифров Datagram Transport Layer Security (DTLS) и защищенного профиля безопасности для расширения DTLS, применяемого при установке ключей для Secure Real-time Transport Protocol (DTLS-SRTP). | 2 |
| **17.2.3** | Убедитесь, что медиасервер проверяет аутентификацию Secure Real-time Transport Protocol (SRTP) для предотвращения атак с внедрением Real-time Transport Protocol (RTP), которые могут привести к отказу в обслуживании (Denial of Service) или вставке поддельного аудио-/видеоконтента в медиапотоки. | 2 |
| **17.2.4** | Убедитесь, что медиасервер способен продолжать обработку входящего медиатрафика при получении некорректных пакетов Secure Real-time Transport Protocol (SRTP). | 2 |
| **17.2.5** | Убедитесь, что медиасервер способен продолжать обработку входящего медиатрафика даже при флуде (массовой атаке) пакетами Secure Real-time Transport Protocol (SRTP) от легитимных пользователей. | 3 |
| **17.2.6** | Убедитесь, что медиасервер не подвержен уязвимости "Гонка ClientHello" (ClientHello Race Condition) в Datagram Transport Layer Security (DTLS), проверив наличие известных уязвимостей в публичных источниках или выполнив тестирование на воспроизведение условий гонки. | 3 |
| **17.2.7** | Убедитесь, что механизмы аудио- и видеозаписи, связанные с медиасервером, способны продолжать обработку входящего медиатрафика даже при флуде (массовой атаке) пакетов Secure Real-time Transport Protocol (SRTP) от легитимных пользователей. | 3 |
| **17.2.8** | Убедитесь, что сертификат Datagram Transport Layer Security (DTLS) проверяется на соответствие атрибуту отпечатка (fingerprint) в Session Description Protocol (SDP), с немедленным прекращением медиапотока в случае несоответствия — это гарантирует подлинность передаваемых данных. | 3 |

## V17.3 Сигнализация

Данный раздел устанавливает требования для систем, использующих собственные серверы сигнализации WebRTC. Сигнализация координирует peer-to-peer (P2P) взаимодействие и должна быть устойчива к атакам, способным нарушить установление сеансов или управление соединениями. 

Для обеспечения безопасной сигнализации системы должны корректно обрабатывать некорректные входные данные и оставаться доступными под нагрузкой.

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **17.3.1** | Убедитесь, что сигнальный сервер способен продолжать обработку легитимных входящих сообщений сигнализации даже в условиях флуд-атаки. Для этого необходимо реализовать механизм ограничения частоты запросов (rate limiting) на уровне сигнализации. | 2 |
| **17.3.2** | Убедитесь, что сигнальный сервер способен продолжать обработку легитимных сообщений сигнализации даже при получении некорректных сообщений, которые могут вызвать отказ в обслуживании (Denial of Service, DoS). Для этого необходимо реализовать: проверку входных данных (input validation), безопасную обработку целочисленных переполнений (integer overflows), защиту от переполнения буферов (buffer overflows) и другие надежные методы обработки ошибок. | 2 |

## Ссылки

Для дополнительной информации см. также:

* DoS-атака WebRTC DTLS ClientHello лучше всего документирована в записи [блога Enable Security для специалистов по безопасности](https://www.enablesecurity.com/blog/novel-dos-vulnerability-affecting-webrtc-media-servers/) и соответствующем [техническом документе для разработчиков WebRTC](https://www.enablesecurity.com/blog/webrtc-hello-race-conditions-paper/)
* [RFC 3550 - RTP: A Transport Protocol for Real-Time Applications](https://www.rfc-editor.org/rfc/rfc3550)
* [RFC 3711 - The Secure Real-time Transport Protocol (SRTP)](https://datatracker.ietf.org/doc/html/rfc3711)
* [RFC 5764 - Datagram Transport Layer Security (DTLS) Extension to Establish Keys for the Secure Real-time Transport Protocol (SRTP))](https://datatracker.ietf.org/doc/html/rfc5764)
* [RFC 8825 - Overview: Real-Time Protocols for Browser-Based Applications](https://www.rfc-editor.org/info/rfc8825)
* [RFC 8826 - Security Considerations for WebRTC](https://www.rfc-editor.org/info/rfc8826)
* [RFC 8827 - WebRTC Security Architecture](https://www.rfc-editor.org/info/rfc8827)
* [DTLS-SRTP Protection Profiles](https://www.iana.org/assignments/srtp-protection/srtp-protection.xhtml)
