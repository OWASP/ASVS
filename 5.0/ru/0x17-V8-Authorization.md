# V8 Авторизация

## Цель контроля

Механизмы авторизации обеспечивают доступ только разрешённым субъектам (пользователям, сервисам и другим клиентам). Для соблюдения принципа наименьших привилегий (POLP) проверяемые приложения должны соответствовать следующим концептуальным требованиям:

* Документировать правила авторизации, включая факторы принятия решений и контекст окружения.
* Субъекты должны иметь доступ только к тем ресурсам, на которые у них есть разрешения.

## V8.1 Документация по авторизации

Полная документация по авторизации необходима для обеспечения согласованного применения решений в области безопасности, возможности аудита и соответствия политикам организации. Это снижает риск несанкционированного доступа, делая требования безопасности понятными и выполнимыми для разработчиков, администраторов и тестировщиков.

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **8.1.1** | Убедитесь, что документация по авторизации определяет правила ограничения доступа на уровне функций и на уровне данных на основе прав субъекта и атрибутов ресурса. | 1 |
| **8.1.2** | Убедитесь, что документация по авторизации определяет правила ограничения доступа на уровне полей (как на чтение, так и на запись) на основе прав субъекта и атрибутов ресурса. Эти правила могут зависеть от других атрибутов объекта данных, например, статуса. | 2 |
| **8.1.3** | Убедитесь, что документация определяет, какие атрибуты окружения и контекста (например, время суток, IP-адрес, местоположение, устройство) используются приложением для принятия решений в области аутентификации и авторизации. | 3 |
| **8.1.4** | Убедитесь, что документация по аутентификации и авторизации определяет, как используются факторы окружения и контекста в принятии решений, наряду с правилами доступа к функциям, данным и полям. Документация должна содержать оцениваемые атрибуты, пороговые значения риска, действия (разрешить, отказать, повысить уровень аутентификации и др.). | 3 |

## V8.2 Архитектура авторизации

Реализация детализированных механизмов авторизации на уровне функций, данных и полей обеспечивает субъектам наличие прав доступа только к тем компонентам, которые были им явно предоставлены.

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **8.2.1** | Убедитесь, что приложение обеспечивает доступ на уровне функций (function-level) только субъектам с явными разрешениями. | 1 |
| **8.2.2** | Убедитесь, что приложение обеспечивает доступ на уровне данных (data-specific) только тем субъектам, которым явно предоставлены права к определённым элементам данных, чтобы предотвратить IDOR (Insecure Direct Object Reference) и BOLA-уязвимости (Broken Object Level Authorization). | 1 |
| **8.2.3** | Убедитесь, что приложение обеспечивает доступ на уровне полей (field-level) только субъектам тем субъектам, которым явно предоставлены права к определённым полям, чтобы предотвратить BOPLA (Broken Object Property Level Authorization). | 2 |
| **8.2.4** | Убедитесь, что реализованы адаптивные меры безопасности, основанные на атрибутах окружения и контекста субъекта (время, местоположение, IP, устройство), которые используются для принятия решений об аутентификации и авторизации, как это определено в документации приложения. Эти меры должны применяться как при попытке субъекта начать новую сессию, так и во время существующей сессии. | 3 |

## V8.3 Авторизация на уровне операций

Немедленное применение изменений авторизации на соответствующем уровне архитектуры критически важно для предотвращения несанкционированных действий, особенно в динамически меняющихся системах.

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **8.3.1** | Убедитесь, что правила авторизации реализуются на доверенном сервисном уровне и не зависят от элементов, которые может контролировать клиент (например, JavaScript на стороне клиента). | 1 |
| **8.3.2** | Убедитесь, что изменения значений, влияющих на авторизацию, применяются немедленно. Если это невозможно (например, при использовании автономных токенов), должны быть реализованы компенсирующие меры: оповещения о попытке несанкционированного действия и откат изменений. Обратите внимание, что данный подход не предотвращает утечку информации. | 3 |
| **8.3.3** | Убедитесь, что доступ к объекту осуществляется на основе прав субъекта, инициировавшего запрос, а не прав промежуточного сервиса, действующего от его имени. Например, если пользователь обращается к веб-сервису с автономным токеном для аутентификации, а сервис затем запрашивает данные у другого сервиса, второй сервис должен использовать токен пользователя, а не токен первого сервиса для принятия решения о доступе. | 3 |

## V8.4 Прочие аспекты авторизации

Дополнительные меры контроля, особенно в административных интерфейсах и многопользовательских (мультитенантных) системах, помогают предотвратить несанкционированный доступ.

| # | Описание | Уровень |
| :---: | :--- | :---: |
| **8.4.1** | Убедитесь, что в мультитенантных приложениях реализованы механизмы, предотвращающие действия потребителя в отношении арендаторов, к которым у него нет доступа. | 2 |
| **8.4.2** | Убедитесь, что доступ к административным интерфейсам защищён несколькими уровнями контроля, включая непрерывную проверку личности, контроль защищённости устройства и анализ контекстных рисков. Недостаточно опираться только на IP-адрес или доверенные устройства. | 3 |

## Ссылки

Подробнее:

* [OWASP Web Security Testing Guide: Authorization](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/05-Authorization_Testing)
* [OWASP Authorization Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Authorization_Cheat_Sheet.html)
