# V13 Configuration

## هدف

پیکربندی پیش‌فرض برنامه برای استفاده در اینترنت باید امن باشد.

این فصل راهنمایی‌هایی در مورد پیکربندی‌های مختلف لازم برای دستیابی به این هدف را ارائه می‌دهد، از جمله پیکربندی‌هایی که در طول توسعه، ساخت و استقرار اعمال می‌شوند.

 موضوعات پوشش داده‌شده شامل جلوگیری از نشت داده‌ها، مدیریت امن ارتباط بین اجزا و حفاظت از secrets است.

## V13.1 Configuration Documentation

این بخش الزامات مستندسازی را برای نحوه‌ی ارتباط برنامه با سرویس‌های داخلی و خارجی، و همچنین تکنیک‌هایی برای جلوگیری از کاهش دسترسی به دلیل عدم دسترسی به سرویس ارائه می‌دهد. همچنین به مستندسازی مرتبط با secrets نیز پرداخته می‌شود.

| #          | شرح الزام                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | سطح |
|:----------:|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |:---:|
| **13.1.1** | تمامی نیازهای ارتباطی برنامه باید به‌طور کامل مستندسازی شده باشند. این مستندسازی شامل سرویس‌های خارجی که برنامه به آن‌ها وابسته است و همچنین مواردی که کاربر نهایی جهت اتصال به سرویس خارجی مشخص می‌کند باید باشد.                                                                                                                                                                                                                                                                                                                                                                   | 2   |
| **13.1.2** | برای هر سرویسی که برنامه استفاده می‌کند، مستندسازی باید شامل حداکثر تعداد ارتباطات همزمان (مثلاً محدودیت‌های Connection Pool) و نحوه‌ی رفتار برنامه هنگام رسیدن به این حد باشد، از جمله هر مکانیزم بازیابی یا جایگزین، تا از بروز شرایط Denial of Service جلوگیری شود.                                                                                                                                                                                                                                                                                                               | 3   |
| **13.1.3** | مستندات برنامه باید استراتژی‌های مدیریت منابع را برای هر سیستم یا سرویس خارجی که استفاده می‌کند مشخص کرده باشد (مثلاً پایگاه‌های داده، هندل‌های فایل، رشته‌ها، اتصالات HTTP) این مستندسازی باید شامل این موارد باشد :رویه‌های آزادسازی منابع، تنظیمات تایم‌اوت، مدیریت خطاها، جایی که منطق Retry اعمال می‌شود، شامل محدودیت تعداد Retry، تأخیرها و الگوریتم‌هایBack-off. برای عملیات همزمان درخواست–پاسخ HTTP (Synchronous)، مستندات باید تایم‌اوت کوتاه را الزام کند و یا Retryها را غیرفعال کند یا به‌طور سختگیرانه محدود کند تا از تاخیرهای زنجیره‌ای و هدررفت منابع جلوگیری شود. | 3   |
| **13.1.4** | مستندسازی برنامه باید شامل secretهای حیاتی برای امنیت برنامه و همچنین برنامه‌ای برای چرخش آن‌ها باشد( بر اساس مدل تهدید سازمان و نیازهای کسب‌وکار).                                                                                                                                                                                                                                                                                                                                                                                                                                  | 3   |

## V13.2 Backend Communication Configuration

برنامه‌ها با چندین سرویس از جمله APIها، پایگاه‌های داده یا سایر اجزا تعامل دارند. این سرویس‌ها ممکن است نسبت به برنامه اجزای داخلی محسوب شوند اما در مکانیزم‌های کنترل دسترسی استاندارد برنامه گنجانده نشده باشند، یا کاملاً خارجی باشند. در هر صورت، لازم است برنامه برای تعامل امن با این اجزا پیکربندی شود و در صورت نیاز، این پیکربندی نیز محافظت گردد.

توجه: فصل "Secure Communication" راهنمایی‌هایی برای رمزگذاری در حین انتقال را ارائه می‌دهد.

| #          | شرح الزام                                                                                                                                                                                                                                                                                                                                                                                               | سطح |
|:----------:|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |:---:|
| **13.2.1** | رتباطات بین اجزای بک‌اند برنامه که از مکانیزم استاندارد نشست کاربران برنامه پشتیبانی نمی‌کنند، از جمله APIها، میان‌افزارها و لایه‌های داده، باید احراز هویت شده باشند. احراز هویت باید با استفاده از حساب‌های سرویس جداگانه، توکن‌های کوتاه‌مدت یا احراز هویت مبتنی بر گواهی انجام شود و نباید از اعتبارنامه‌های ثابت مانند رمز عبور، کلیدهای API یا حساب‌های مشترک با دسترسی‌های سطح بالا استفاده شود. | 2   |
| **13.2.2** | ارتباطات بین اجزای بک‌اند، از جمله سرویس‌های محلی یا سیستم‌عامل، APIها، میان‌افزارها و لایه‌های داده، با حساب‌هایی باید انجام شود که کمترین سطح دسترسی لازم را دارند.                                                                                                                                                                                                                                   | 2   |
| **13.2.3** | اگر اعتبارنامه‌ای برای احراز هویت سرویس استفاده می‌شود، اعتبارنامه‌ای که توسط مصرف‌کننده استفاده می‌شود، اعتبارنامه پیش‌فرض نباشد (مثلاً root/root یا admin/admin).                                                                                                                                                                                                                                     | 2   |
| **13.2.4** | یک allowlist برای تعیین منابع یا سیستم‌های خارجی که برنامه مجاز به ارتباط با آن‌ها است باید وجود داشته باشد (مثلاً برای درخواست‌های خروجی، بارگذاری داده یا دسترسی به فایل). این allowlist می‌تواند در لایه برنامه، وب‌سرور، فایروال یا ترکیبی از لایه‌های مختلف پیاده‌سازی شود.                                                                                                                        | 2   |
| **13.2.5** | وب‌سرور یا سرور برنامه با یک allowlist از منابع یا سیستم‌هایی که سرور می‌تواند به آن‌ها درخواست ارسال کند یا داده‌ها و فایل‌ها را بارگذاری کند پیکربندی شده باشد.                                                                                                                                                                                                                                       | 2   |
| **13.2.6** | در مواقعی که برنامه به سرویس‌های جداگانه متصل می‌شود، پیکربندی مستندسازی‌شده برای هر اتصال رعایت شود، از جمله حداکثر ارتباطات همزمان، رفتار هنگام رسیدن به حداکثر ارتباط مجاز، زمان‌های Timeout اتصال و استراتژی‌های Retry.                                                                                                                                                                             | 3   |

## V13.3 Secret Management

مدیریت secret یک وظیفه پیکربندی حیاتی است تا از حفاظت داده‌های مورد استفاده در برنامه اطمینان حاصل شود. الزامات خاص مربوط به رمزنگاری در فصل "Cryptography" قابل دسترسی است، اما این بخش بر مدیریت و نحوه‌ی برخورد با secret تمرکز دارد.

| #          | شرح الزام                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | سطح |
|:----------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |:---:|
| **13.3.1** | یک راهکار مدیریت secret، مانند Key Vault، برای ایجاد امن، ذخیره، کنترل دسترسی و از بین بردن secret بک‌اند استفاده شود. این secret می‌تواند شامل رمزعبورها، داده‌های رمز نگاری، اطلاعات حساس مربوط به اتصال به پایگاه داده و سیستم‌های شخص ثالث، کلیدها و seedهای توکن‌های زمان‌محور، سایر secretهای داخلی و کلیدهای API باشد. Secret نباید در کد منبع برنامه یا در build artifacts قرار گیرد. برای برنامه‌های L3، این باید شامل راهکاری مبتنی بر سخت‌افزار مانند HSM باشد. | 2   |
| **13.3.2** | دسترسی به دارایی‌های secret بر اساس اصل حداقل دسترسی (Least Privilege) رعایت شود.                                                                                                                                                                                                                                                                                                                                                                                          | 2   |
| **13.3.3** | تمام عملیات رمزنگاری باید با استفاده از یک ماژول امنیتی ایزوله (مانند Vault یا Hardware Security Module) انجام شود تا مواد کلیدی به‌طور امن مدیریت و محافظت شده و از افشای خارج از ماژول امنیتی جلوگیری شود.                                                                                                                                                                                                                                                               | 3   |
| **13.3.4** | secretها بر اساس مستندسازی برنامه طوری پیکربندی شوند که منقضی شده و چرخش داده شوند.                                                                                                                                                                                                                                                                                                                                                                                        | 3   |

## V13.4 Unintended Information Leakage

پیکربندی‌های production باید به‌گونه‌ای امن شوند که از افشای داده‌های غیرضروری جلوگیری شود. بسیاری از این مسائل به ندرت به‌عنوان ریسک‌های مهم ارزیابی می‌شوند، اما اغلب با سایر آسیب‌پذیری‌ها زنجیره‌ای می‌شوند. اگر این مسائل به‌صورت پیش‌فرض وجود نداشته باشند، سطح دشواری حمله به برنامه افزایش می‌یابد.

به‌عنوان مثال، مخفی کردن نسخه‌ی اجزای سرور باعث حذف نیاز به به‌روزرسانی تمام اجزا نمی‌شود، و غیرفعال کردن نمایش فهرست پوشه‌ها نیاز به استفاده از کنترل‌های دسترسی یا نگهداری فایل‌ها دور از پوشه عمومی را از بین نمی‌برد، اما سطح دشواری حمله را افزایش می‌دهد.

| #          | شرح الزام                                                                                                                                                                                           | سطح |
|:----------:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |:---:|
| **13.4.1** | برنامه باید به‌گونه‌ای مستقر شود که هیچ‌گونه متادیتای کنترل نسخه، از جمله پوشه‌های .git یا .svn، در دسترس نباشد یا به شکلی باشد که این پوشه‌ها نه از بیرون و نه توسط خود برنامه قابل دسترسی نباشند. | 1   |
| **13.4.2** | حالت‌های Debug برای تمام اجزا در محیط‌های production باید غیرفعال شده باشند تا از افشای قابلیت‌های دیباگ و نشت اطلاعات جلوگیری شود.                                                                 | 2   |
| **13.4.3** | وب‌سرورها فهرست‌بندی دایرکتوری‌ها را به کاربر نهایی نباید نمایش دهند مگر اینکه به‌طور صریح مورد نظر باشد.                                                                                           | 2   |
| **13.4.4** | از متد HTTP TRACE در محیط‌های production نباید پشتیبانی شود تا از احتمال نشت اطلاعات جلوگیری شود.                                                                                                   | 2   |
| **13.4.5** | مستندسازی‌ها (مانند مستندات APIهای داخلی) و نقاط پایش (Monitoring Endpoints) در دسترس نباشند مگر اینکه به‌طور صریح مورد نظر باشد.                                                                   | 2   |
| **13.4.6** | تأیید کنید که برنامه اطلاعات نسخه دقیق اجزای backend را افشا نکند.                                                                                                                                  | 3   |
| **13.4.7** | Verify that the web tier is configured to only serve files with specific file extensions to prevent unintentional information, configuration, and source code leakage.                              | 3   |

## References

برای اطلاعات بیشتر، همچنین به منابع زیر مراجعه کنید:

* [OWASP Web Security Testing Guide: Configuration and Deployment Management Testing](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing)
