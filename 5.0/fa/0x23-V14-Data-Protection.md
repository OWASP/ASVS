# V14 Data Protection

## هدف

برنامه‌ها نمی‌توانند تمام الگوهای استفاده و رفتارهای کاربران را پیش‌بینی کنند، بنابراین باید کنترل‌هایی را پیاده‌سازی کنند تا از دسترسی غیرمجاز به داده‌های حساس روی دستگاه‌های کاربر جلوگیری شود.

این فصل شامل الزاماتی است که چه داده‌هایی باید محافظت شوند، چگونه باید محافظت شوند، و همچنین مکانیزم‌های خاصی که باید پیاده‌سازی شوند یا اشتباهاتی که باید از آن‌ها اجتناب شود.

یکی دیگر از مواردی که باید در حفاظت از داده‌ها در نظر گرفت، استخراج عمده، تغییر یا استفاده بیش از حد از داده‌ها است. الزامات هر سیستم احتمالاً بسیار متفاوت خواهند بود، بنابراین تعیین اینکه چه چیزی «غیرعادی» محسوب می‌شود باید بر اساس مدل تهدید و ریسک کسب‌وکار انجام گیرد. از دیدگاه ASVS، شناسایی این مسائل در فصل «Security Logging and Error Handling» بررسی می‌شود و تعیین محدودیت‌ها در فصل «Validation and Business Logic» مطرح شده است.

## V14.1 Data Protection Documentation

یکی از پیش‌نیازهای اصلی برای حفاظت از داده‌ها، دسته‌بندی داده‌هایی است که باید به‌عنوان داده حساس در نظر گرفته شوند. به‌احتمال زیاد چند سطح متفاوت از حساسیت وجود خواهد داشت و برای هر سطح، کنترل‌های لازم جهت حفاظت از داده‌ها متفاوت خواهد بود.

 مقررات و قوانین مختلفی در حوزه حریم خصوصی وجود دارند که بر نحوه ذخیره‌سازی، استفاده و انتقال داده‌های شخصی حساس توسط برنامه‌ها تأثیر می‌گذارند. این بخش دیگر تلاشی برای تکرار چنین قوانین یا مقرراتی در زمینه حفاظت از داده یا حریم خصوصی نمی‌کند، بلکه تمرکز آن بر ملاحظات فنی کلیدی برای حفاظت از داده‌های حساس است. لطفاً قوانین و مقررات محلی را بررسی کرده و در صورت نیاز با یک متخصص حریم خصوصی یا وکیل واجد شرایط مشورت کنید.

| #          | شرح الزام                                                                                                                                                                                                                                                                                                                                                                                                                                               | سطح |
|:----------:| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:---:|
| **14.1.1** | تمامی داده‌های حساس ایجادشده و پردازش‌شده توسط برنامه باید شناسایی شده و بر اساس سطوح حفاظتی طبقه‌بندی شده‌اند. این موضوع شامل داده‌هایی می‌شود که صرفاً کُدگذاری شده‌اند و به‌راحتی قابل بازیابی هستند، مانند رشته‌های Base64 یا محتوای متنی (plaintext) داخل یک JWT. سطوح حفاظتی باید الزامات قوانین و استانداردهای حفاظت از داده و حریم خصوصی که برنامه ملزم به رعایت آن‌هاست را در نظر بگیرند.                                                      | 2   |
| **14.1.2** | برای تمامی سطوح حفاظت از داده‌های حساس، مجموعه‌ای مستند از الزامات حفاظتی تعریف شده باشد. این الزامات باید شامل (اما محدود به آن نباشد) موارد زیر باشند: الزامات مرتبط با رمزنگاری کلی، بررسی صحت و یکپارچگی، دوره‌های نگهداری داده، نحوه ثبت داده‌ها در لاگ، کنترل‌های دسترسی به داده‌های حساس در لاگ‌ها، رمزنگاری در سطح پایگاه داده، الزامات مربوط به حریم خصوصی و فناوری‌های تقویت‌کننده حریم خصوصی مورد استفاده، و سایر الزامات مرتبط با محرمانگی. | 2   |

## V14.2 General Data Protection

این بخش شامل مجموعه‌ای از الزامات عملی برای حفاظت از داده‌ها می‌باشد. بیشتر این الزامات به مسائل خاصی مانند نشت ناخواسته داده‌ها مربوط می‌شوند، اما یک الزام کلی نیز وجود دارد که بر پیاده‌سازی کنترل‌های حفاظتی بر اساس سطح حفاظت موردنیاز برای هر داده تأکید دارد.

| #          | شرح الزام                                                                                                                                                                                                                                                                                    | سطح |
|:----------:| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:---:|
| **14.2.1** | داده‌های حساس باید فقط در بدنه پیام HTTP یا فیلدهای هدر به سرور ارسال شوند، و اینکه URL و query string شامل اطلاعات حساس (مانند API key یا session token) نباشند.                                                                                                                            | 1   |
| **14.2.2** | برنامه باید از cache شدن داده‌های حساس در اجزای سرور مانند Load Balancer و Application Cache جلوگیری کند، یا اطمینان حاصل شود که داده‌ها پس از استفاده به‌طور ایمن پاک‌سازی می‌شوند.                                                                                                         | 2   |
| **14.2.3** | داده‌های حساس تعریف‌شده به طرف‌های غیرقابل اعتماد (مانند User Trackers) نباید ارسال شوند تا از جمع‌آوری ناخواسته داده‌ها خارج از کنترل برنامه جلوگیری شود.                                                                                                                                   | 2   |
| **14.2.4** | کنترل‌های مرتبط با داده‌های حساس شامل رمزنگاری، بررسی صحت و یکپارچگی، نگهداری، نحوه ثبت داده‌ها در لاگ، کنترل‌های دسترسی به داده‌های حساس در لاگ‌ها، حریم خصوصی و فناوری‌های مربوط به حریم خصوصی، مطابق با آنچه در مستندات برای سطح حفاظت مشخص هر داده تعریف شده است، پیاده‌سازی شوند.       | 2   |
| **14.2.5** | مکانیزم‌های cache باید طوری پیکربندی شده باشند که تنها پاسخ‌هایی با نوع محتوای مورد انتظار برای آن منبع cache شوند و شامل محتوای حساس یا پویا نباشند. وب‌سرور باید هنگام دسترسی به فایل ناموجود، پاسخ 404 یا 302 برگرداند و نه فایل معتبر دیگر، تا از حملات Web Cache Deception جلوگیری شود. | 3   |
| **14.2.6** | برنامه باید تنها حداقل داده‌های حساس مورد نیاز برای عملکرد برنامه را بازگرداند. برای مثال، تنها برخی از ارقام شماره کارت اعتباری بازگردانده شود و نه شماره کامل. در صورتی که داده کامل لازم باشد، باید در رابط کاربری masked شود مگر اینکه کاربر به‌طور مشخص آن را مشاهده کند.               | 3   |
| **14.2.7** | اطلاعات حساس باید تحت طبقه‌بندی دوره‌ای نگهداری داده قرار گرفته باشند، به‌گونه‌ای که داده‌های قدیمی یا غیرضروری به‌طور خودکار، در یک برنامه زمان‌بندی‌شده مشخص، یا براساس نیاز حذف شوند.                                                                                                     | 3   |
| **14.2.8** | اطلاعات حساس باید از متادیتای فایل‌های ارسال‌شده توسط کاربر حذف شود، مگر اینکه ذخیره‌سازی آن با رضایت کاربر انجام شود.                                                                                                                                                                       | 3   |

## V14.3 Client-side Data Protection

این بخش شامل الزامات جلوگیری از نشت داده‌ها به روش‌های خاص در سمت کلاینت یا سمت User Agent برنامه است.

| #          | شرح الزام                                                                                                                                                                                                                                                                                       | سطح |
|:----------:| -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:---:|
| **14.3.1** | داده‌های احراز هویت‌شده از حافظه کلاینت، مانند DOM مرورگر، پس از خروج کلاینت یا Session پاک شوند. فیلد هدر Clear-Site-Data در پاسخ سرور می‌تواند در این زمینه مفید باشد، اما کلاینت باید بتواند داده‌ها را حتی زمانی که اتصال به سرور در دسترس نیست در زمان پایان Session (خروج از آن) پاک کند. | 1   |
| **14.3.2** | برنامه باید هدرهای پاسخ HTTP، anti-cach مناسب (مانند Cache-Control: no-store) را تنظیم کند تا داده‌های حساس در مرورگرها cache نشوند.                                                                                                                                                            | 2   |
| **14.3.3** | برای اطلاعات بیشتر، همچنین به منابع زیر مراجعه کنید:                                                                                                                                                                                                                                            | 2   |

## References

For more information, see also:

* [Consider using the Security Headers website to check security and anti-caching header fields](https://securityheaders.com/)
* [Documentation about anti-caching headers by Mozilla](https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching)
* [OWASP Secure Headers project](https://owasp.org/www-project-secure-headers/)
* [OWASP Privacy Risks Project](https://owasp.org/www-project-top-10-privacy-risks/)
* [OWASP User Privacy Protection Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/User_Privacy_Protection_Cheat_Sheet.html)
* [Australian Privacy Principle 11 - Security of personal information](https://www.oaic.gov.au/privacy/australian-privacy-principles/australian-privacy-principles-guidelines/chapter-11-app-11-security-of-personal-information)
* [European Union General Data Protection Regulation (GDPR) overview](https://www.edps.europa.eu/data-protection_en)
* [European Union Data Protection Supervisor - Internet Privacy Engineering Network](https://www.edps.europa.eu/data-protection/ipen-internet-privacy-engineering-network_en)
* [Information on the "Clear-Site-Data" header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Clear-Site-Data)
* [White paper on Web Cache Deception](https://www.blackhat.com/docs/us-17/wednesday/us-17-Gil-Web-Cache-Deception-Attack-wp.pdf)
