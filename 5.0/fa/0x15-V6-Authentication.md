# V6 Authentication

## Control Objective

احراز هویت فرآیند تأیید یا اثبات اصالت یک فرد یا دستگاه می‌باشد. این فرآیند شامل بررسی صحت ادعاهای ارائه شده توسط یک شخص یا یک دستگاه بوده به‌گونه‌ای که در برابر جعل هویت مقاوم باشد و از بازیابی یا رهگیری گذرواژه‌ها جلوگیری کند.

استاندارد [NIST SP 800-63](https://pages.nist.gov/800-63-3/) یک استاندارد مدرن و مبتنی بر شواهد است که برای سازمان‌های سراسر جهان ارزشمند محسوب می‌شود و برای سازمان‌های دولتی ایالات متحده و نهادهایی که با این سازمان‌ها تعامل دارند، اهمیت ویژه‌ای دارد. 

اگر چه بسیاری از الزامات مطرح شده در این فصل بر اساس بخش دوم این استاندارد (با عنوان NIST SP 800-63B تحت عنوان «راهنمای هویت دیجیتال – احراز هویت و مدیریت چرخه عمر») بنا شده اند، تمرکز این فصل بر تهدیدات رایج و ضعف‌های پر تکرار در احراز هویت می‌باشد. این فصل تلاشی برای پوشش جامع تمامی نکات استاندارد نمی‌کند. در مواردی که رعایت کامل استاندارد NIST SP 800-63 ضروری باشد، لطفاً به متن کامل این استاندارد مراجعه فرمایید.

همچنین، ممکن است اصطلاحات به‌کاررفته درNIST SP 800-63  با اصطلاحات عمومی‌تر تفاوت داشته باشد؛ به همین دلیل، این فصل عمدتاً از واژگان رایج‌تر و قابل فهم‌تر استفاده می‌کند تا وضوح مطلب افزایش یابد.

یکی از ویژگی‌های رایج در سامانه‌های پیشرفته‌تر، تطبیق‌پذیری مراحل احراز هویت با توجه به عوامل مختلف ریسک است. این ویژگی در فصل Authorization مورد بررسی قرار می‌گیرد، چرا که این مکانیزم‌ها باید در تصمیم‌گیری‌های مربوط  به Authorization نیز لحاظ شوند.

## V6.1 Authentication Documentation

این بخش شامل الزامات مربوط به مستندسازی احراز هویت است که باید برای یک برنامه کاربردی نگهداری شود. این مستندسازی برای پیاده‌سازی و ارزیابی نحوه پیکربندی کنترل‌های مرتبط با احراز هویت از اهمیت بالایی برخوردار است.

| #         | Description                                                                                                                                                                                                                                                                                                                                                                                         | سطح |
|:---------:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |:---:|
| **6.1.1** | مستندات برنامه، نحوه استفاده از کنترل هایی مانند محدودیت نرخ (Rate Limit)، مقابله با خودکارسازی (Anti-Automation) و پاسخ تطبیقی (Adaptive Response) را برای دفاع در برابر حملاتی مانند Credential Stuffing و حملات Password Brute Force به وضوح تعریف کرده باشد. مستندات باید به‌وضوح نحوه پیکربندی این کنترل‌ها را تشریح کرده و نشان دهند که چگونه از قفل شدن مخرب حساب‌های کاربری جلوگیری می‌شود. | 1   |
| **6.1.2** | یک لیست از کلمات خاص مرتبط با زمینه سازمانی‌ (Context-Specific) مستندسازی شود تا از بکارگیری آنها در رمزهای عبور جلوگیری شد. این فهرست می‌تواند شامل نام سازمان، نام محصول، شناسه سامانه، نام کد پروژه، نام دپارتمان یا نقش های سازمانی و موارد مشابه باشد.                                                                                                                                         | 2   |
| **6.1.3** | در صورت وجود مسیرهای متعدد احراز هویت در برنامه کاربردی، تمامی این مسیرها به همراه کنترل‌های امنیتی و سطح قدرت احراز هویت مورد نیاز، مستندسازی شده‌اند. لازم است این کنترل‌ها به‌صورت یکسان و سازگار در تمامی مسیرهای احراز هویت اجرا شوند.                                                                                                                                                         | 2   |

## V6.2 Password Security

کلمات عبور، که توسط NIST SP 800-63 به عنوان "رمزهای به خاطر سپرده شده" (Memorized Secrets) شناخته می‌شوند، شامل کلمات عبور، عبارت‌های عبور، کدهای PIN، الگوهای بازگشایی (unlock Patterns)، انتخاب تصویر صحیح (مثلاً انتخاب بچه‌گربه صحیح از میان چند تصویر) هستند. این‌ها معمولاً به عنوان "چیزی که شما می‌دانید" در نظر گرفته می‌شوند و اغلب به عنوان یک مکانیزم احراز هویت تک‌عاملی استفاده می‌شوند. 

بر این اساس، این بخش شامل الزامات و توصیه‌هایی برای ایجاد و مدیریت امن کلمات عبور می‌باشد. بیشتر این الزامات در سطحL1  مطرح شده‌اند، چرا که در این سطح نقش کلیدی دارند. از سطح L2  به بعد، استفاده از احراز هویت چندعاملی الزامی می‌باشد، که در آن گذرواژه می‌تواند یکی از عوامل تشکیل‌دهنده باشد. 

الزامات این بخش عمدتاً به بند [5.1.1.2](https:/pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) از راهنمایی‌های [NIST](https://pages.nist.gov/800-63-3/sp800-63b.html) می‌باشد.

| #          | شرح الزام                                                                                                                                                                                                                        | سطح |
|:----------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |:---:|
| **6.2.1**  | کلمات عبور تنظیم شده توسط کاربر حداقل ۸ کاراکتر طول داشته باشد. هرچند حداقل ۱۵ کاراکتر به شدت توصیه می‌شود.                                                                                                                      | 1   |
| **6.2.2**  | کاربران قادر به تغییر گذرواژه خود باشند.                                                                                                                                                                                         | 1   |
| **6.2.3**  | هنگام تغییر کلمه عبور، گذرواژه فعلی و گذرواژه جدید توسط کاربر تکمیل شود.                                                                                                                                                         | 1   |
| **6.2.4**  | کلمات عبوری که در حین ثبت‌نام حساب کاربری یا تغییر کلمه عبور ارسال می شوند با یک فهرست در دسترس از حداقل ۳۰۰۰ کلمه عبور رایج که ( با سیاست‌های کلمه عبور برنامه (مانند حداقل طول) سازگاری دارند) بررسی شوند.                     | 1   |
| **6.2.5**  | کلمات عبور با هر ترکیبی قابل استفاده باشند، بدون اینکه قوانینی برای محدودکردن نوع کاراکترهای مجاز وجود داشته باشد. نباید هیچ‌گونه الزامی برای تعداد حداقل کاراکترهای حروف بزرگ یا کوچک، اعداد یا کاراکترهای خاص وجود داشته باشد. | 1   |
| **6.2.6**  | فیلدهای ورودی کلمه عبور از نوع "type=password" استفاده می‌کنند تا ورودی‌ها پنهان شوند. برنامه‌ها می‌توانند به کاربر این امکان را بدهند که موقتاً کلمه عبور کامل یا آخرین کاراکتر تایپ شده را مشاهده کند.                         | 1   |
| **6.2.7**  | عملکرد "چسباندن" (paste)، ابزارهای کمکی گذرواژه مرورگر و مدیریت‌کننده‌های گذرواژه خارجی مجاز باشند.                                                                                                                              | 1   |
| **6.2.8**  | برنامه کلمه عبور کاربر را دقیقاً همانطور که از کاربر دریافت شده است، بدون هیچ گونه تغییراتی مانند کوتاه‌سازی(truncation) یا تبدیل حروف بزرگ و کوچک (case transformation)، بررسی کند.                                             | 1   |
| **6.2.9**  | استفاده از گذرواژه‌هایی با حداقل طول ۶۴ کاراکتر مجاز باشد.                                                                                                                                                                       | 2   |
| **6.2.10** | کلمه عبور کاربر تا زمانی که مشخص شود که به خطر افتاده است یا کاربر آن را تغییر دهد، معتبر باقی بماند. برنامه نباید الزام به تغییر دوره‌ای گذرواژه‌ها را داشته باشد.                                                              | 2   |
| **6.2.11** | فهرست مستند شده ای از کلمات خاص مرتبط با زمینه‌ سازمانی برای جلوگیری از ایجاد کلمات عبور آسان قابل حدس، مورد استفاده قرار گیرد.                                                                                                  | 2   |
| **6.2.12** | کلمات عبور وارد شده در حین ثبت‌نام حساب کاربری یا تغییر کلمه عبور با مجموعه‌ای از کلمات عبور افشا شده بررسی ‌شوند.                                                                                                               | 2   |

## V6.3 General Authentication Security

این بخش شامل الزامات عمومی برای امنیت مکانیزم‌های احراز هویت و همچنین تعیین انتظارات مربوط به سطوح مختلف امنیتی می‌باشد. در سطح L2، سامانه‌ها باید الزاماً از احراز هویت چندعاملی (MFA) استفاده کنند. در سطح L3، استفاده از احراز هویت مبتنی بر سخت‌افزار الزامی می‌باشد که باید درون یک محیط اجرای مورد اعتماد و قابل گواهی (Trusted Execution Environment – TEE) انجام شود. این می‌تواند شامل کلیدهای عبور وابسته به دستگاه (Device-Bound Passkeys)، احرازکننده‌های با سطح اطمینان بالا مطابق با استاندارد eIDAS (سطح LoA High)، احرازکننده‌های دارای سطح اطمینان AAL3 طبق استاندارد NIST، یا مکانیزم‌های معادل دیگر باشد.

اگرچه این الزامات در مقایسه با بسیاری از چارچوب‌های دیگر، رویکردی سخت‌گیرانه نسبت به MFA دارند، اما این سخت‌گیری برای ارتقای سطح امنیت کاربران حیاتی می‌باشد. هرگونه تلاش برای کاهش این الزامات باید با یک برنامه شفاف و دقیق برای کاهش ریسک‌های مرتبط با احراز هویت همراه باشد، به‌طوری‌که راهنمایی‌ها و پژوهش‌های ارائه‌شده توسط NIST نیز در آن لحاظ شده باشد.

توجه داشته باشید که در زمان انتشار این سند، استانداردNIST SP 800-63  استفاده از ایمیل را به عنوان یک مکانیزم احراز هویت [قابل قبول نمی‌داند]([NIST SP 800-63 Digital Identity Guidelines-FAQ](https://pages.nist.gov/800-63-FAQ/#q-b11)).([archived copy](https://web.archive.org/web/20250330115328/https://pages.nist.gov/800-63-FAQ/#q-b11))

الزامات این بخش به بخش‌های مختلفی از راهنمای [NIST]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html)) مربوط می‌شوند، از جمله بندهای [۴.۲.۱]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html#421-permitted-authenticator-types))، [۴.۳.۱]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html#431-permitted-authenticator-types))، [۵.۲.۲]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html#522-rate-limiting-throttling)) و [۶.۱.۲]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html#-612-post-enrollment-binding)).

| #         | شرح الزام                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | سطح |
|:---------:|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |:---:|
| **6.3.1** | کنترل‌های لازم برای جلوگیری از حملاتی مانند Credential Stuffing و password brute force طبق مستندات امنیتی برنامه پیاده‌سازی شوند.                                                                                                                                                                                                                                                                                                                                                                                      | 1   |
| **6.3.2** | حساب‌های کاربری پیش‌فرض (مانند "admin"، "root" یا "sa") در برنامه وجود نداشته باشند یا غیرفعال شده باشند.                                                                                                                                                                                                                                                                                                                                                                                                              | 1   |
| **6.3.3** | برای دسترسی به برنامه، از یک مکانیزم احراز هویت چندعاملی (MFA) یا ترکیبی از مکانیزم‌های احراز هویت تک‌عاملی استفاده شود. برای سطح L3، حداقل یکی از عوامل احراز هویت باید مبتنی بر سخت‌افزار باشد در برابر حملات فیشینگ، مقاومت در برابر نفوذ و جعل هویت را فراهم کند، در حالی که با اقدام آگاهانه کاربر (مانند فشردن دکمه روی کلید سخت‌افزاری FIDO یا تلفن همراه) قصد کاربر برای احراز هویت را نیز تأیید نماید. هرگونه تسهیل یا تعدیل در این الزام، مستلزم ارائه دلایل مستند و مجموعه‌ای جامع از کنترل‌های جبرانی است. | 2   |
| **6.3.4** | تأیید کنید که در صورت وجود مسیرهای متعدد احراز هویت در برنامه، هیچ مسیر احراز هویتِ مستندسازی‌نشده‌ای وجود نداشته باشد و کنترل‌های امنیتی و سطح قدرت احراز هویت در تمامی مسیرها به‌صورت یکسان و سازگار اعمال شوند.                                                                                                                                                                                                                                                                                                     | 2   |
| **6.3.5** | کاربران از تلاش‌های مشکوک برای احراز هویت (موفق یا ناموفق) مطلع ‌شوند. این اطلاع‌رسانی می‌تواند شامل تلاش برای احراز هویت از موقعیت مکانی یا کلاینت غیرمعمول، احراز هویت ناقص (تنها موفقیت یکی از عوامل)، تلاش برای احراز هویت پس از یک دوره طولانی عدم فعالیت، یا احراز هویت موفق پس از چندین تلاش ناموفق باشد.                                                                                                                                                                                                       | 3   |
| **6.3.6** | ایمیل به‌عنوان مکانیزم احراز هویت، چه به‌صورت تک‌عاملی و چه به‌عنوان یکی از عوامل احراز هویت چندعاملی، استفاده نمی‌شود.                                                                                                                                                                                                                                                                                                                                                                                                | 3   |
| **6.3.7** | کاربران پس از به‌روزرسانی اطلاعات احراز هویت خود، مانند بازنشانی گذرواژه یا تغییر نام کاربری یا آدرس ایمیل، مطلع شوند.                                                                                                                                                                                                                                                                                                                                                                                                 | 3   |
| **6.3.8** | با توجه به پیام‌های خطا، کدهای پاسخ HTTP یا تفاوت در زمان پاسخ‌دهی، نتوان کاربران معتبر را از طریق تلاش‌های ناموفق احراز هویت شناسایی کرد. همچنین، عملکردهای ثبت‌نام و بازیابی گذرواژه نیز باید از این نوع افشای اطلاعات محافظت شده باشند.                                                                                                                                                                                                                                                                             | 3   |

## V6.4 Authentication Factor Lifecycle and Recovery

عوامل احراز هویت می‌توانند شامل کلمه عبور، توکن‌های نرم‌افزاری، توکن‌های سخت‌افزاری و دستگاه‌های بیومتریک باشند. مدیریت امن چرخه عمر این مکانیزم‌ها برای حفظ امنیت برنامه اهمیت بسیاری دارد و این بخش شامل الزامات مرتبط با این موضوع می‌باشد.

الزامات این بخش عمدتاً مربوط به بندهای [۵.۱.۱.۲]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver)) و [۶.۱.۲.۳]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html#replacement)) از راهنمای [NIST]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html)) می‌باشد.

| #         | شرح الزام                                                                                                                                                                                                                                                                | سطح |
|:---------:|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |:---:|
| **6.4.1** | کلمه عبور اولیه یا کدهای فعال‌سازی تولید شده توسط سیستم، به‌صورت تصادفی و ایمن تولید ‌شوند، با سیاست فعلی رمز عبور مطابقت دارند، و پس از مدت زمان کوتاهی یا پس از اولین استفاده منقضی می‌شوند. این رمزهای اولیه نباید به عنوان رمز عبور بلندمدت مورد استفاده قرار گیرند. | 1   |
| **6.4.2** | راهنمای کلمه عبور یا احراز هویت مبتنی بر دانش (که به عنوان "سؤالات امنیتی" شناخته می‌شوند) در سیستم وجود ندارد.                                                                                                                                                          | 1   |
| **6.4.3** | فرآیند امنی برای بازنشانی کلمه عبور فراموش‌شده پیاده‌سازی شده است که هیچ‌یک از مکانیزم‌های احراز هویت چندعاملی فعال را دور نزند.                                                                                                                                         | 2   |
| **6.4.4** | در صورت از دست رفتن یکی از عوامل احراز هویت چندعاملی، فرآیند اثبات هویت با همان سطحی که در زمان ثبت‌نام انجام شده است، اجرا شود.                                                                                                                                         | 2   |
| **6.4.5** | دستورالعمل‌های تمدید مکانیزم‌های احراز هویت دارای تاریخ انقضا برای کاربران به موقع ارسال می‌شود تا پیش از انقضای مکانیزم فعلی  فرصت کافی برای تمدید وجود داشته باشد، و در صورت لزوم، یادآورهای خودکار نیز تنظیم و ارسال شده باشند.                                       | 3   |
| **6.4.6** | کاربران ادمین می‌توانند فرآیند بازنشانی کلمه عبور را برای کاربران عادی آغاز کنند، اما اجازه تغییر مستقیم یا انتخاب رمز عبور برای کاربر را ندارند. این کنترل  برای جلوگیری از دسترسی ادمین به رمز عبور کاربران طراحی شده است.                                             | 3   |

## V6.5 General Multi-factor authentication requirements

این بخش راهنمایی‌های کلی ارائه می‌دهد که برای انواع مختلف مکانیزم‌های احراز هویت چندعاملی (MFA) قابل استفاده است. مکانیزم‌های بررسی‌شده شامل موارد زیر هستند:

* Lookup Secrets (فرایند یافتن یا بازیابی اطلاعات محرمانه)
* رمزهای عبور یک‌بار مصرف مبتنی بر زمان (TOTPs)
* مکانیزم‌های خارج از باند (Out-of-Band Mechanisms) 

Lookup Secret کدهایی هستند که به‌صورت از پیش تولیدشده ارائه می‌شوند و مشابه با کدهای مجوز تراکنش (TAN)، کدهای بازیابی حساب‌های شبکه‌های اجتماعی یا شبکه‌ای از مقادیر تصادفی می‌باشند. این نوع مکانیزم به‌عنوان "چیزی که در اختیار دارید" در نظر گرفته می‌شود، زیرا کدها عمداً غیرقابل حفظ‌کردن هستند و نیاز به ذخیره‌سازی دارند.

رمزهای یکبار مصرف چندعاملی (Multi-factor TOTPs) مشابه رمزهای یکبار مصرف تک‌عاملی هستند، اما برای ایجاد رمز نهایی (OTP)، نیاز به وارد کردن کد PIN معتبر، بازکردن با بیومتریک، وارد کردن USB یا جفت‌سازی NFC، یا مقدار اضافی دیگری (مانند ماشین‌حساب‌های امضای تراکنش) دارند.

جزئیات مربوط به مکانیزم‌های خارج از باند (Out-of-Band) در بخش بعدی ارائه خواهد شد.

الزامات موجود در این بخش‌ها عمدتاً مربوط به بندهای [۵.۱.۲]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html#-512-look-up-secrets))، [۵.۱.۳]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html#-513-out-of-band-devices))، [۵.۱.۴.۲]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html#5142-single-factor-otp-verifiers))، [۵.۱.۵.۲]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html#5152-multi-factor-otp-verifiers))، [۵.۲.۱]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html#521-physical-authenticators)) و [۵.۲.۳]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html#523-use-of-biometrics)) از راهنمای [NIST]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html)) می‌باشند.

| #         | شرح الزام                                                                                                                                                                                                                                                                                                                                                              | سطح |
|:---------:|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |:---:|
| **6.5.1** | Lookup Secrets  درخواست‌ها یا کدهای احراز هویت خارج از باند (Out-of-Band) و رمزهای یکبار مصرف مبتنی بر زمان (TOTP) تنها یک‌بار قابل استفاده باشند و پس از استفاده موفق، مجدداً قابل استفاده نباشند.                                                                                                                                                                    | 2   |
| **6.5.2** | در صورت ذخیره‌سازی Lookup Secrets در سمت Backend برنامه، اگر مقدار آنتروپی کمتر از ۱۱۲ بیت باشند (معادل ۱۹ کاراکتر تصادفی الفبایی-عددی یا ۳۴ رقم تصادفی)، باید با یک الگوریتم تایید شده برای ذخیره رمز عبور و با استفاده از یک Salt تصادفی ۳۲ بیتی هش شوند. در صورتی که آنتروپی کد ۱۱۲ بیت یا بیشتر باشد، می‌توان از یک تابع هش استاندارد برای ذخیره سازی استفاده کرد. | 2   |
| **6.5.3** | Lookup Secrets کدهای احراز هویت خارج از باند (out of band) و تولید رمزهای یکبار مصرف مبتنی بر زمان(TOTP) همگی با استفاده از یک تولیدکننده عدد شبه تصادفی ‌رمزنگاری‌شده (CSPRNG) تولید شده باشند تا از تولید مقادیر قابل پیش‌بینی جلوگیری شود.                                                                                                                          | 2   |
| **6.5.4** | Lookup Secrets و کدهای احراز هویت خارج از باند (out of band) حداقل دارای ۲۰ بیت آنتروپی باشند (معمولاً ۴ کاراکتر تصادفی الفبایی-عددی یا ۶ رقم تصادفی برای رسیدن به این میزان آنتروپی کافی است).                                                                                                                                                                        | 2   |
| **6.5.5** | درخواست‌ها، کدها یا توکن‌های احراز هویت خارج از باند (Out-of-Band) و همچنین رمزهای عبور یک‌بار مصرف مبتنی بر زمان (TOTP) دارای طول عمر مشخص باشند. حداکثر طول عمر برای درخواست‌های خارج از باند باید ۱۰ دقیقه و برای TOTP حداکثر ۳۰ ثانیه باشد.                                                                                                                        | 2   |
| **6.5.6** | امکان لغو (Revoke) هر عامل احراز هویت، از جمله دستگاه‌های فیزیکی، در صورت سرقت یا مفقود شدن وجود داشته باشد.                                                                                                                                                                                                                                                           | 3   |
| **6.5.7** | مکانیزم‌های احراز هویت بیومتریک فقط به‌عنوان عامل دوم و در کنار یکی از عوامل «چیزی که در اختیار دارید» یا «چیزی که کاربر می داند» مورد استفاده قرار می‌گیرند.                                                                                                                                                                                                          | 3   |
| **6.5.8** | اعتبارسنجی رمزهای یک‌بار مصرف مبتنی بر زمان (TOTP) بر اساس منبع زمانی از یک سرویس قابل اعتماد انجام می‌شود و نه بر اساس زمان ارائه‌شده توسط کلاینت یا منابع غیرقابل اعتماد.                                                                                                                                                                                            | 3   |

## V6.6 Out-of-Band authentication mechanisms

این نوع احراز هویت معمولاً شامل ارتباط سرور احراز هویت با یک دستگاه فیزیکی از طریق یک کانال ثانویه امن است. به‌عنوان مثال، ارسال Push Notifications  به دستگاه‌های تلفن همراه. این نوع از مکانیزم احراز هویت به‌عنوان "چیزی که در اختیار دارید" در نظر گرفته می‌شود.

مکانیزم‌های ناامن احراز هویت خارج از باند نظیر ایمیل و VOIP مجاز نیستند. همچنین، احراز هویت از طریق خطوط تلفن عمومی (PSTN) و پیامک (SMS) در حال حاضر توسط NIST به‌عنوان مکانیزم‌های”محدودشده” ([Restricted]([NIST SP 800-63 Digital Identity Guidelines-FAQ](https://pages.nist.gov/800-63-FAQ/#q-b01))) دسته‌بندی شده‌اند و باید به به تدریج  با مکانیزم‌هایی مانند رمز یک‌بار مصرف مبتنی بر زمان ( مکانیزم‌های رمزنگاری‌شده یا روش‌های مشابه امن‌تر جایگزین شوند. استاندارد NIST SP 800-63B در بند [۵.۱.۳.۳]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html#-5133-authentication-using-the-public-switched-telephone-network)) توصیه می‌کند که در صورت ضرورت پشتیبانی از احراز هویت خارج از باند تلفنی یا پیامکی، باید ریسک‌هایی مانند تعویض دستگاه، تغییر سیم‌کارت، انتقال شماره یا رفتارهای غیرعادی دیگر مدنظر قرار گیرد. هرچند این بخش از چارچوب ASVS الزام صریحی برای رعایت این موارد ندارد، اما عدم توجه به این ملاحظات امنیتی در یک اپلیکیشن حساس با سطح امنیتی L2 یا L3 باید به‌عنوان یک علامت هشدار جدی تلقی شود.

توجه داشته باشید که NIST اخیراً راهنمایی‌هایی ارائه کرده است که استفاده از [Push Notifications]([Authenticators](https://pages.nist.gov/800-63-4/sp800-63b/authenticators/#fig-3)) را نامطلوب می‌داند. هرچند این بخش از ASVS به این موضوع اشاره نکرده است، آگاهی از خطرات ناشی از حمله Push Bombing اهمیت بالایی دارد. 

| #         | شرح الزام                                                                                                                                                                                                                                                                                                                                                                                                                            | سطح |
|:---------:|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |:---:|
| **6.6.1** | مکانیزم‌های احراز هویت مبتنی بر شبکه تلفن عمومی (PSTN) برای ارسال رمزهای یک‌بار مصرف (OTP) از طریق تماس تلفنی یا پیامک تنها در صورتی که شماره تلفن قبلا اعتبارسنجی شده باشد، یا روش‌های جایگزین قوی‌تر (رمزهای عبور یکبار مصرف مبتنی بر زمان) در دسترس باشند ارائه می‌شوند و سرویس‌دهنده باید کاربران را از ریسک‌های امنیتی این روش‌ها مطلع سازد. برای اپلیکیشن‌های سطح L3، استفاده از تماس تلفنی و پیامک به‌عنوان گزینه، مجاز نیست. | 2   |
| **6.6.2** | درخواست‌ها، کدها یا توکن‌های احراز هویت خارج از باند (Out-of-Band) به درخواست احراز هویت اصلی که برای آن تولید شده‌اند متصل باشند و قابل استفاده برای درخواست‌های قبلی یا بعدی نباشند.                                                                                                                                                                                                                                               | 2   |
| **6.6.3** | مکانیزم‌های احراز هویت خارج از باند (Out-of-Band) مبتنی بر کد، در برابر حملات brute force از طریق اعمال کنترل محدودیت نرخ (Rate Limiting) محافظت شوند. همچنین، استفاده از کدی با حداقل ۶۴ بیت آنتروپی (Entropy)مدنظر قرار گیرد.                                                                                                                                                                                                      | 2   |
| **6.6.4** | در صورت استفاده از Push Notifications جهت احراز هویت چند عاملی، محدودیت نرخ (Rate Limiting)  به منظور جلوگیری از حملات Push Bombing اعمال شده باشد. استفاده از تطبیق عدد Matching) Number) نیز می‌تواند به کاهش این ریسک کمک کند.                                                                                                                                                                                                    | 3   |

## V6.7 Cryptographic authentication mechanism

مکانیزم‌های احراز هویت رمزنگاری‌شده شامل کارت‌های هوشمند یا کلیدهای FIDO هستند، که در آن‌ها کاربر باید دستگاه رمزنگاری را به رایانه متصل کرده یا با آن جفت کند تا فرآیند احراز هویت تکمیل شود. در این روش، سرور احراز هویت یک عدد تصادفی (Nonce) چالشی به دستگاه یا نرم‌افزار رمزنگاری ارسال می‌کند و دستگاه یا نرم‌افزار بر اساس کلید رمزنگاری securely ذخیره‌شده، پاسخی را محاسبه می‌کند. الزامات این بخش راهنمایی‌های خاص پیاده‌سازی این مکانیزم‌ها را ارائه می‌دهد و راهنمایی‌های مربوط به الگوریتم‌های رمزنگاری در فصل «رمزنگاری» آورده شده است.

در مواردی که کلیدهای مشترک یا کلیدهای محرمانه برای احراز هویت رمزنگاری‌شده مورد استفاده قرار می‌گیرند، لازم است این کلیدها به همان روشی که سایر اسرار سیستمی مدیریت می‌شوند، نگهداری شوند. همان‌طور که در بخش «Secret Management» از فصل «Configuration» مستندسازی شده است.

الزامات این بخش عمدتاً مربوط به بند [۵.۱.۷.۲]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html#sfcdv)) از راهنمای [NIST]([NIST Special Publication 800-63B](https://pages.nist.gov/800-63-3/sp800-63b.html)) می‌باشد.

| #         | شرح الزام                                                                                                                                      | سطح |
|:---------:|:---------------------------------------------------------------------------------------------------------------------------------------------- |:---:|
| **6.7.1** | گواهینامه‌های مورد استفاده برای تأیید ادعاهای احراز هویت رمزنگاری‌شده به گونه‌ای ذخیره شوند که از تغییر یا دستکاری آن‌ها محافظت شود.           | 3   |
| **6.7.2** | مقدار چالش (Challenge Nonce) حداقل ۶۴ بیت طول داشته باشد و از نظر آماری یکتا باشد یا حداقل در طول عمر دستگاه رمزنگاری منحصر به فرد باقی بماند. | 3   |

## V6.8 Authentication with an Identity Provider

ارائه‌دهندگان هویت (Identity Providers یا IdPs) هویت فدرال شده برای کاربران فراهم می‌کنند. کاربران اغلب بیش از یک هویت با چندین ارائه‌دهنده هویت دارند، مانند هویت سازمانی که از طریق Azure AD، Okta، Ping Identity یا Google مدیریت می‌شود، یا هویت مصرف‌کننده که از طریق شبکه‌های اجتماعی مانند Facebook، Twitter، Google یا WeChat ایجاد می‌شود. این فهرست تأیید یا حمایت از این شرکت‌ها یا خدمات نیست، بلکه صرفاً تشویقی برای توسعه‌دهندگان است تا واقعیت وجود چندین هویت برای بسیاری از کاربران را در نظر بگیرند. سازمان‌ها باید با توجه به پروفایل ریسک و قدرت اثبات هویت ارائه‌دهنده هویت، به ادغام با هویت‌های موجود کاربران فکر کنند. به عنوان مثال، سازمان‌های دولتی به‌احتمال زیاد هویت شبکه‌های اجتماعی را به‌عنوان روش ورود به سیستم‌های حساس قبول نمی‌کنند، زیرا ایجاد هویت‌های جعلی یا موقت در این فضا ساده است، در حالی که شرکت‌های فعال در حوزه بازی‌های موبایل ممکن است برای افزایش تعداد بازیکنان فعال خود نیاز به ادغام با پلتفرم‌های اصلی شبکه‌های اجتماعی داشته باشند.

استفاده امن از ارائه‌دهندگان هویت خارجی نیازمند پیکربندی و تأیید دقیق است تا از جعل هویت یا ادعاهای ساختگی جلوگیری شود. این بخش شامل الزامات لازم برای مقابله با این ریسک‌ها می‌باشد.

| #         | شرح الزام                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | سطح |
|:---------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |:---:|
| **6.8.1** | اگر برنامه از چند ارائه‌دهنده هویت (IdP) پشتیبانی می‌کند، امکان جعل هویت کاربر از طریق یک ارائه‌دهنده هویت دیگر وجود نداشته باشد (برای مثال، با استفاده از شناسه کاربری یکسان). مکانیسم استاندارد برای جلوگیری از این تهدید، این است که برنامه، کاربران را با استفاده از ترکیب شناسه IdP (به‌عنوان فضای نام یا (namespace و شناسه کاربر در آن، IdP ثبت و شناسایی کند.                                                                                                                                                                                                                                                                        | 2   |
| **6.8.2** | وجود و یکپارچگی امضاهای دیجیتال بر روی تصدیق‌های (تقاضاها یا ادعاهای) احراز هویت برای مثال بر روی (توکن‌های JWT یا SAML assertions) همواره اعتبارسنجی می‌شود و هرگونه تصدیقی که فاقد امضا یا  دارای امضای نامعتبر باشد، رد می‌گردد.                                                                                                                                                                                                                                                                                                                                                                                                          | 2   |
| **6.8.3** | (تقاضاها یا ادعاهای) تصدیق‌های SAML به‌صورت منحصربه‌فرد پردازش شده و تنها یک‌بار در بازه‌ی اعتبار خود استفاده می‌شوند تا از حملات بازپخش (Replay Attacks) جلوگیری گردد.                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 2   |
| **6.8.4** | Verify that, if an application uses a separate Identity Provider (IdP) and expects specific authentication strength, methods, or recentness for specific functions, the application verifies this using the information returned by the IdP. For example, if OIDC is used, this might be achieved by validating ID Token claims such as 'acr', 'amr', and 'auth_time' (if present). If the IdP does not provide this information, the application must have a documented fallback approach that assumes that the minimum strength authentication mechanism was used (for example, single-factor authentication using username and password). | 2   |

## References

برای اطلاعات بیشتر، همچنین به منابع زیر مراجعه کنید:

* [NIST SP 800-63 - Digital Identity Guidelines](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63-3.pdf)
* [NIST SP 800-63B - Authentication and Lifecycle Management](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63b.pdf)
* [NIST SP 800-63 FAQ](https://pages.nist.gov/800-63-FAQ/)
* [OWASP Web Security Testing Guide: Testing for Authentication](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/04-Authentication_Testing)
* [OWASP Password Storage Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html)
* [OWASP Forgot Password Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Forgot_Password_Cheat_Sheet.html)
* [OWASP Choosing and Using Security Questions Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Choosing_and_Using_Security_Questions_Cheat_Sheet.html)
* [CISA Guidance on "Number Matching"](https://www.cisa.gov/sites/default/files/publications/fact-sheet-implement-number-matching-in-mfa-applications-508c.pdf)
* [Details on the FIDO Alliance](https://fidoalliance.org/)
