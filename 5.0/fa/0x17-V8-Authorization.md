# V8 Authorization

## هدف

مجوز دسترسی، تضمین می‌کند که دسترسی‌ها فقط در اختیار مصرف کنندگان مجاز (کاربران،سرورها و سایر کلاینت‌ها) قرار گیرد. به منظور اعمال اصل حداقل دسترسی(POLP)، برنامه‌های کاربردی مورد تایید باید این الزامات سطح بالا را احصاء نمایند:

* قوانین صدور مجوزها که شامل عوامل دخیل در تصمیم گیری و عوامل محیطی است را مستند سازی نمایید.
* دسترسی مصرف کنندگان به منابع باید بر اساس حقوق تعریف شده آن‌ها مجاز شمرده شود.

## V8.1 Authorization Documentation

مستند سازی جامع مجوزها به منظور اطمینان از اعمال پیوسته، قابلیت ممیزی(Auditable) و همسو بودن تصمیمات امنیتی با سیاست‌های سازمانی ضروری است و همچنین با شفاف سازی و اجرایی کردن الزامات امنیتی برای توسعه دهندگان، مدیران سیستم و آزمون‌گر‌های ریسک دسترسی غیر مجاز را کاهش می‌دهد.

| #         | شرح الزام                                                                                                                                                                                                                                                                                                                  | سطح |
|:---------:|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |:-----:|
| **8.1.1** | مستند اعطای مجوز باید شامل قوانینی به منظور محدودسازی دسترسی در سطح عملکرد و دسترسی مبتنی بر داده بر اساس مجوزهای کاربران و ویژگی‌های منابع باشد.                                                                                                                                                                            | 1     |
| **8.1.2** | مستند اعطای مجوز باید قوانینی را برای محدودیت‌های دسترسی در سطح Field بر اساس مجوزهای کاربران و ویژگی‌های منابع تعریف نماید(هر دو دسترسی خواندن و نوشتن). توجه داشته باشید که این قوانین ممکن است به مقادیر دیگر ویژگی‌های شیء داده ی مربوطه (Relevant Data Object) بستگی داشته باشند، مانند حالت (state) یا وضعیت (status). | 2     |
| **8.1.3** | مستند برنامه کاربردی باید ویژگی‌های محیطی و زمینه‌ای (شامل و نه محدود به زمان روز، مکان، آدرس IP یا دستگاه) که در برنامه کاربردی به منظور اتخاذ تصمیمات امنیتی (نظیر آن دسته از تصمیماتی که مربوط به احراز هویت و اعطای مجوز می باشد) را مشخص کند.                                                                           | 3     |
| **8.1.4** | مستندات احراز هویت و اعطای مجوز، علاوه بر اعطای مجوز در سطح Field، سطح عملکرد و داده‌های خاص، چگونگی استفاده از عوامل محیطی و زمینه‌ای در اتخاذ تصمیمات را مشخص نماید.                                                                                                                                                       | 3     |

## V8.2 General Authorization Design

پیاده سازی کنترل‌های اعطای مجوز جزئیدر سطح عملکرد، داده و فیلدها، تضمین می‌کند که مصرف کنندگان فقط قادر به دسترسی به آن چیزی هستند که صریحا به آن‌ها دسترسی داده شده است.

| #         | شرح الزام                                                                                                                                                                                                                                                                                                                                           | سطح |
|:---------:|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |:-----:|
| **8.2.1** | برنامه کاربردی باید از محدود بودن دسترسی‌‌های در سطح عملکرد به مشتریانی که دارای دسترسی صریح هستند اطمینان حاصل نماید.                                                                                                                                                                                                                                | 1     |
| **8.2.2** | برنامه کاربردی باید از محدود بودن دسترسی‌‌های در سطح داده به مشتریانی که دارای دسترسی صریح به اقلام داده‌ای خاص هستند اطمینان حاصل نماید تا از این طریق خطر آسیب پذیری IDOR و  broken object level authorization را کاهش دهد .                                                                                                                        | 1     |
| **8.2.3** | برنامه کاربردی دسترسی در سطح Field را با مجوزهای صریح به Field ها برای مصرف کنندگان جهت کاهش خطر broken object property level authorization  (BOPLA) محدود کرده باشد.                                                                                                                                                                                 | 2     |
| **8.2.4** | کنترل‌های امنیتی تطبیقی که بر اساس ویژگی‌های محیطی و زمینه‌ای کاربر (مانند زمان روز، مکان، آدرس IP یا دستگاه) هستند، برای تصمیم‌گیری‌های احراز هویت (Authentication) و مجوزدهی (Authorization)  طبق مستندات برنامه پیاده‌سازی شده‌اند. این کنترل‌ها باید هم در زمان تلاش کاربر برای شروع یک نشست (Session) جدید و هم در طول یک نشست فعال، اعمال شوند. | 3     |

## V8.3 Operation Level Authorization

اجرای فوری تغییرات در مجوز‌های دسترسی در لایه مناسب از معماری برنامه کاربردی به منظور جلوگیری از اقدامات غیرمجاز بویژه در محیط های پویا ضروری است.

| #         | شرح الزام                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | سطح |
|:---------:|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |:-----:|
| **8.3.1** | برنامه کاربردی قوانین مجوزدهی را در یک لایه سرویس معتبر اعمال نموده و بر آن دسته از کنترل‌هایی که مصرف کنندگان نامعتبر قادر به دستکاری آن‌ها هستند متکی نباشد. (نظیر جاوا اسکریپت سمت کاربر)                                                                                                                                                                                                                                                                                                                                                    | 1     |
| **8.3.2** | در مواقعی که امکان اعمال فوری تغییرات وجود ندارد (مثلاً وقتی که سیستم برای تصمیم‌گیری در مجوزدهی از توکن‌های Self-Contained مثل JWT  استفاده می‌کند که اطلاعات را داخل خود ذخیره کرده و تا زمان انقضا تغییر نمی‌کنند)، باید کنترل‌های جبرانی وجود داشته باشد. این کنترل‌ها باید بتوانند زمانی که کاربر عملی را انجام می‌دهد که دیگر مجاز به آن نیست، هشدار بدهند و تغییر را برگردانند. با این حال، توجه کنید که این راهکار جایگزین نمی‌تواند جلوی نشت اطلاعات را بگیرد.                                                                         | 3     |
| **8.3.3** | دسترسی به یک object بر اساس مجوزهای کاربری شخص درخواست کننده(مثال: مصرف کننده) باشد نه بر اساس مجوز‌های یک واسطه یا سرویسی که به نمایندگی از او عمل می‌کند. بطور مثال، در صورتی که یک مصرف کننده یک وب سرویس را با استفاده از یک توکن self-contained برای احراز هویت فراخوانی می‌کند و سپس آن سرویس اطلاعات را از یک سرویس دیگر درخواست می‌کند، سرویس دوم باید همان توکن مصرف کننده را استفاده کند، نه یک توکن سرویس-به-سرویس (Machine-to-Machine token) که متعلق به سرویس اول است، تا تصمیمات مجوزدهی دقیقاً بر اساس مجوزهای کاربر گرفته شوند. | 3     |

## V8.4 Other Authorization Considerations

ملاحظات اضافه‌تری برای مجوزدهی ، بویژه برای درگاه‌های مدیریتی و محیط‌های چند کاربره(multi tenants)  وجود دارد که برای جلوگیری از دسترسی غیر مجاز مفید هستند.

| #         | شرح الزام                                                                                                                                                                                                                                                                                                                                                                        | سطح |
|:---------:|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |:-----:|
| **8.4.1** | برنامه های کاربردی چند کاربره(multi tenants) از کنترل های cross-tenant به منظور تضمین این امر که عملیات‌های مصرف کنندگان هرگز کاربرانی (tenants) را که مجوز تعامل با آنها را ندارند را تحت تأثیر قرار نمی‌دهد.                                                                                                                                                                     | 2     |
| **8.4.2** | دسترسی به درگاه‌های پیکربندی شامل چندین لایه امنیتی از قبیل تأیید مداوم هویت مصرف‌کننده، ارزیابی وضعیت امنیتی دستگاه و تحلیل ریسک زمینه‌ای باشد تا از این طریق اطمینان حاصل شود که موقعیت شبکه‌ای یا نقاط پایانی معتبر تنها عوامل برای مجوزدهی نیستند اگر چه که این عوامل احتمال دسترسی غیرمجاز را کاهش می‌دهند. | 3     |

## References

برای اطلاعات بیشتر، همچنین به منابع زیر مراجعه کنید:

* [OWASP Web Security Testing Guide: Authorization](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/05-Authorization_Testing)
* [OWASP Authorization Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Authorization_Cheat_Sheet.html)
