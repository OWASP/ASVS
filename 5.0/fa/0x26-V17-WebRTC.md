# V17 WebRTC

## هدف

Web Real-Time Communication (WebRTC) امکان تبادل صوت، تصویر و داده به‌صورت لحظه‌ای در برنامه‌های مدرن را فراهم می‌کند. با افزایش پذیرش این فناوری، تأمین امنیت زیرساخت WebRTC اهمیت حیاتی پیدا می‌کند. این بخش الزامات امنیتی را برای ذی‌نفعانی ارائه می‌دهد که سیستم‌های WebRTC را توسعه، میزبانی یا یکپارچه می‌کنند.

صنعت WebRTC را می‌توان به‌طور کلی به سه بخش تقسیم کرد:

1. توسعه‌دهندگان محصول: فروشندگان اختصاصی و متن‌باز که محصولات و راهکارهای WebRTC را ایجاد و عرضه می‌کنند. تمرکز آن‌ها بر توسعه فناوری‌های قوی و امن WebRTC است که توسط دیگران قابل استفاده باشد.

نیازمندی‌های امنیتی مطرح شده در اینجا عمدتاً بر توسعه‌دهندگان محصول، ارائه‌دهندگان CPaaS و ارائه‌دهندگان خدمات متمرکز است که:

* از راه‌حل‌های متن‌باز برای ساخت برنامه‌های WebRTC خود استفاده می‌کنند.
* از محصولات تجاری WebRTC به‌عنوان بخشی از زیرساخت خود استفاده می‌کنند.
* از راه‌حل‌های WebRTC که به‌صورت داخلی توسعه داده‌اند استفاده می‌کنند یا اجزای مختلف را در یک سرویس یکپارچه ترکیب می‌کنند.

قابل توجه است که این الزامات امنیتی شامل توسعه‌دهندگانی نمی‌شود که صرفاً از SDKها و APIهای ارائه‌شده توسط ارائه‌دهندگان CPaaS استفاده می‌کنند. برای چنین توسعه‌دهندگانی، مسئولیت بیشتر مسائل امنیتی زیرساختی معمولاً بر عهده ارائه‌دهندگان CPaaS است و استاندارد امنیتی عمومی مانند ASVS ممکن است به‌طور کامل نیازهای آن‌ها را پوشش ندهد.

## V17.1 TURN Server

این بخش الزامات امنیتی را برای سیستم‌هایی که سرورهای TURN (Traversal Using Relays around NAT) خود را راه‌اندازی می‌کنند، تعریف می‌کند. سرورهای TURN در هدایت Media در محیط‌های شبکه‌ای محدود کمک می‌کنند، اما در صورت پیکربندی نادرست می‌توانند خطراتی ایجاد کنند. این کنترل‌ها بر فیلتر کردن امن آدرس‌ها و جلوگیری از تمام شدن منابع سیستم (resource exhaustion) تمرکز دارند.

| #          | شرح الزام                                                                                                                                                                                                                                      | سطح |
|:----------:| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:---:|
| **17.1.1** | سرویس Traversal Using Relays around NAT (TURN) باید تنها به آدرس‌های IP دسترسی دهد که برای اهداف ویژه رزرو نشده‌اند (مثلاً شبکه‌های داخلی، broadcast، loopback). توجه داشته باشید که این مورد هم برای آدرس‌های IPv4 و هم برای IPv6 صدق می‌کند. | 2   |
| **17.1.2** | سرویس Traversal Using Relays around NAT (TURN)، نباید به resource exhaustion آسیب‌پذیر باشد، حتی زمانی که کاربران قانونی تلاش کنند تعداد زیادی پورت روی سرور TURN باز کنند.                                                                    | 3   |

## V17.2 Media

این الزامات فقط به سیستم‌هایی اعمال می‌شود که سرورهای رسانه‌ای WebRTC خود را میزبانی می‌کنند، مانند Selective Forwarding Units (SFU)، Multipoint Control Units (MCU)، سرورهای Recording یا سرورهای Gateway. سرورهای رسانه(Media) وظیفه پردازش و توزیع جریان‌های رسانه‌ای را بر عهده دارند و امنیت آن‌ها برای محافظت از ارتباطات بین همتاها حیاتی است. حفاظت از جریان‌های رسانه‌ای در برنامه‌های WebRTC از اهمیت بالایی برخوردار است تا از شنود، دستکاری و حملات محروم‌سازی از سرویس(denial-of-service) جلوگیری شود که می‌تواند حریم خصوصی کاربران و کیفیت ارتباط را به خطر بیندازد.

به‌ویژه، لازم است تدابیری برای محافظت در برابر حملات flood مانند rate limiting، اعتبارسنجی timestamps، استفاده از ساعت‌های همگام برای تطبیق بازه‌های زمانی واقعی و مدیریت بافرها به‌منظور جلوگیری از overflow و حفظ زمان‌بندی مناسب، اعمال شود. اگر بسته‌های مربوط به یک جلسه رسانه‌ای خاص خیلی سریع برسند، بسته‌های اضافی باید حذف شوند. همچنین محافظت از سیستم در برابر بسته‌های خراب یا مخرب اهمیت دارد که با اعمال اعتبارسنجی ورودی، مدیریت ایمن سرریز عدد صحیح، جلوگیری از buffer overflows و استفاده از سایر تکنیک‌های مقاوم در برابر خطا، حاصل می‌شود.

سیستم‌هایی که صرفاً بر ارتباط رسانه‌ای همتا‌به‌همتا بین مرورگرهای وب متکی هستند و سرورهای میانی رسانه‌ای در آن‌ها دخالتی ندارند، از این الزامات امنیتی خاص مرتبط با رسانه مستثنی هستند.

این بخش به استفاده از Datagram Transport Layer Security (DTLS) در زمینه WebRTC اشاره دارد. الزامی مربوط به داشتن سیاست مستند برای مدیریت کلیدهای رمزنگاری در فصل «Cryptography» قابل یافت است. اطلاعات مربوط به روش‌های رمزنگاری تأییدشده را می‌توان یا در پیوست Cryptography استاندارد ASVS یا در اسنادی مانند NIST SP 800‑52 Rev. 2 و BSI TR‑02102‑2 (نسخه 2025-01) پیدا کرد.

| #          | شرح الزام                                                                                                                                                                                                                                                                 | سطح |
|:----------:| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:---:|
| **17.2.1** | کلید مربوط به گواهی Datagram Transport Layer Security (DTLS) بر اساس سیاست مستند مدیریت کلیدهای رمزنگاری مدیریت و محافظت می‌شود.                                                                                                                                          | 2   |
| **17.2.2** | سرور Media طوری پیکربندی شده باشد که از مجموعه‌های رمزنگاری تاییدشده Datagram Transport Layer Security (DTLS) استفاده کند و از یک پروفایل محافظتی امن برای گسترش DTLS به منظور ایجاد کلیدها برای پروتکل Secure Real-time Transport Protocol (DTLS-SRTP) پشتیبانی نماید.   | 2   |
| **17.2.3** | احراز هویت Secure Real-time Transport Protocol (SRTP) در سرور Media بررسی ‌شود تا از حملات تزریق Real-time Transport Protocol (RTP) جلوگیری شده و این حملات باعث بروز شرایط Denial of Service یا وارد شدن محتوای صوتی یا تصویری ناخواسته به جریان‌های رسانه‌ای نشوند.     | 2   |
| **17.2.4** | سرور Media باید قادر باشد پردازش ترافیک رسانه‌ای ورودی را حتی هنگام مواجهه با بسته‌های Secure Real-time Transport Protocol (SRTP) ناقص یا خراب ادامه دهد.                                                                                                                 | 2   |
| **17.2.5** | سرور Media باید قادر باشد پردازش ترافیک رسانه‌ای ورودی را حتی در هنگام دریافت سیلی(flood) از بسته‌های Secure Real-time Transport Protocol (SRTP) از کاربران قانونی ادامه دهد.                                                                                             | 3   |
| **17.2.6** | سرور Media نسبت به آسیب‌پذیری "ClientHello Race Condition " در Datagram Transport Layer Security (DTLS) نباید آسیب‌پذیر نباشد، این کار می‌تواند با بررسی اینکه آیا سرور رسانه به‌صورت عمومی به عنوان آسیب‌پذیر شناخته شده است یا با انجام آزمون Race Condition انجام شود. | 3   |
| **17.2.7** | مکانیزم‌های ضبط صدا یا تصویر مرتبط با سرور رسانه در هنگام طوفان بسته‌ای (Flood) از پروتکل انتقال بلادرنگ امن (SRTP) توسط کاربران مجاز، باید قادر به ادامه پردازش ترافیک رسانه ورودی است.                                                                                  | 3   |
| **17.2.8** | گواهی‌نامه امنیت لایه انتقال دیتاگرام (DTLS) باید با ویژگی اثر انگشت (Fingerprint) پروتکل توصیف نشست (SDP) بررسی می‌شود و در صورت شکست در بررسی، جریان رسانه قطع می‌شود تا اصالت جریان رسانه تضمین گردد.                                                                  | 3   |

## V17.3 Signaling

این بخش الزامات سیستم‌هایی را تعریف می‌کند که سرورهای سیگنالینگ WebRTC خود را اداره می‌کنند. سیگنالینگ وظیفه هماهنگی ارتباط peer-to-peer را دارد و باید در برابر حملاتی که می‌توانند بر ایجاد یا کنترل جلسات تأثیر بگذارند مقاوم باشد.

برای اطمینان از سیگنالینگ ایمن، سیستم‌ها باید ورودی‌های ناقص یا مخدوش را به‌صورت امن مدیریت کنند و حتی تحت بار زیاد نیز در دسترس باقی بمانند.

| #          | شرح الزام                                                                                                                                                                                                                                                                                                                                                                     | سطح |
|:----------:| -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:---:|
| **17.3.1** | سرور سیگنالینگ باید قادر باشد حتی در جریان flood attack، پیام‌های سیگنالینگ ورودی مشروع را پردازش کند. این باید با اعمال محدودیت نرخ (rate limiting) در سطح سیگنالینگ محقق شود.                                                                                                                                                                                               | 2   |
| **17.3.2** | سرور سیگنالینگ باید قادر باشد پیام‌های سیگنالینگ مشروع را حتی در مواجهه با پیام‌های سیگنالینگ ناقص یا مخرب که می‌توانند باعث ایجاد شرایط عدم دسترسی (Denial of Service) شوند، پردازش کند. این می‌تواند شامل اعمال اعتبارسنجی ورودی، مدیریت ایمن سرریز عدد صحیح (integer overflow)، جلوگیری از سرریز بافر (buffer overflow) و استفاده از دیگر تکنیک‌های مقاوم مدیریت خطا باشد. | 2   |

## References

برای اطلاعات بیشتر، همچنین به منابع زیر مراجعه کنید:

* The WebRTC DTLS ClientHello DoS is best documented at [Enable Security's blog post aimed at security professionals](https://www.enablesecurity.com/blog/novel-dos-vulnerability-affecting-webrtc-media-servers/) and the associated [white paper aimed at WebRTC developers](https://www.enablesecurity.com/blog/webrtc-hello-race-conditions-paper/)
* [RFC 3550 - RTP: A Transport Protocol for Real-Time Applications](https://www.rfc-editor.org/rfc/rfc3550)
* [RFC 3711 - The Secure Real-time Transport Protocol (SRTP)](https://datatracker.ietf.org/doc/html/rfc3711)
* [RFC 5764 - Datagram Transport Layer Security (DTLS) Extension to Establish Keys for the Secure Real-time Transport Protocol (SRTP))](https://datatracker.ietf.org/doc/html/rfc5764)
* [RFC 8825 - Overview: Real-Time Protocols for Browser-Based Applications](https://www.rfc-editor.org/info/rfc8825)
* [RFC 8826 - Security Considerations for WebRTC](https://www.rfc-editor.org/info/rfc8826)
* [RFC 8827 - WebRTC Security Architecture](https://www.rfc-editor.org/info/rfc8827)
* [DTLS-SRTP Protection Profiles](https://www.iana.org/assignments/srtp-protection/srtp-protection.xhtml)
