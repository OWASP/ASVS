name: Validate ASVS Translation

on:
  workflow_dispatch:
    inputs:
      translated_folder:
        description: "Name of the folder containing translated files (inside docs/)"
        required: true


jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Run validation scripts
        run: |
          set -e
          ORIGINAL_DIR="5.0/en"
          TRANSLATED_DIR="5.0/${{ github.event.inputs.translated_folder }}"

          if [ ! -d "$TRANSLATED_DIR" ]; then
            echo "‚ùå Translated directory not found: $TRANSLATED_DIR"
            exit 1
          fi

          for file in "$ORIGINAL_DIR"/*.md; do
            fname=$(basename "$file")
            translate="$TRANSLATED_DIR/$fname"

            if [ ! -f "$translate" ]; then
              echo "‚ùå Missing translation for $fname"
              exit 1
            fi

            echo "üîç Validating $fname ..."
            if [ "$fname" != "0x92-Appendix-C_Cryptography.md" ]; then
              python 5.0/tools/translation_validation/req_check.py --og "$file" --tr "$translate"
            fi
            python 5.0/tools/translation_validation/structural_check.py --og "$file" --tr "$translate"
          done
