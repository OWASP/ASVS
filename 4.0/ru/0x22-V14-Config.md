# V14 Конфигурация

## Задачи контроля

Убедитесь, что исследуемое приложение имеет:

* Безопасную, воспроизводимую, автоматизированную среду сборки.
* Усиленный контроль над библиотеками, зависимостями и конфигурациями сторонних разработчиков таким образом, чтобы устаревшие или небезопасные компоненты не включались в приложение.

Конфигурация приложения по умолчанию должна быть безопасной для работы в Интернете, что означает безопасную конфигурацию «из коробки».

## V14.1 Сборка и развёртывание

Конвейеры сборки являются основой для повторяемой безопасности. Каждый раз, при обнаружении чего-то небезопасного, его можно устранить в исходном коде, сценариях сборки или развертывания и автоматически протестировать. Мы настоятельно рекомендуем использовать конвейеры сборки с автоматическим контролем безопасности и зависимостей, которые предупреждают или прерывают сборку для предотвращения попадания известных уязвимостей в промышленную среду. Ручные, нерегулярно выполняемые проверки, напрямую приводят к ошибкам, которых можно избежать.

По мере перехода к модели DevSecOps важно обеспечить постоянную доступность и целостность развёртывания и конфигурации для достижения эталонного состояния. В прошлом, если система была взломана, требовалось от нескольких дней до месяцев, чтобы доказать, что вторжения не повторялись. Сегодня, с появлением программно-определяемой инфраструктуры, быстрого A/B развёртывания с нулевым временем простоя и автоматизации контейнерных сборок, стало возможным автоматически и непрерывно создавать, укреплять и развёртывать эталонную замену для скомпрометированной системы.

Если до сих пор используются традиционные модели, то необходимо предпринять ручные шаги по укрепления защиты и резервному копированию этой конфигурации, чтобы обеспечить быструю и своевременную замену скомпрометированных систем на безопасные системы с высокой степенью целостности.

Для соблюдения требований этого раздела требуется автоматизированная система сборки и доступ к сценариям сборки и развёртывания.

| № | Описание | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **14.1.1** | Убедитесь, что процессы сборки и развертывания приложений выполняются безопасным и воспроизводимым образом, например посредством автоматизации CI/CD, автоматизированного управления конфигурациями и автоматизированными сценариями развертывания. | | ✓ | ✓ | |
| **14.1.2** | Убедитесь, что включены флаги компилятора для всех имеющихся мер защиты и предупреждений: о переполнении буфера, включая рандомизацию стека (ASLR), предотвращение выполнения данных (DEP) и прерывание сборки при обнаружении небезопасных операций с указателями, памятью, строками форматирования, целыми числами или строками. | | ✓ | ✓ | 120 |
| **14.1.3** | Убедитесь, что в соответствии с рекомендациями используемого сервера приложений и фреймворка укреплена безопасность конфигурации сервера. | | ✓ | ✓ | 16 |
| **14.1.4** | Убедитесь, что приложение, конфигурация и все зависимости могут быть повторно развернуты с помощью сценариев автоматического развёртывания, созданы из документированного и протестированного runbook в разумные сроки или своевременно восстановлены из резервных копий. | | ✓ | ✓ | |
| **14.1.5** | Убедитесь, что для обнаружения несанкционированного доступа уполномоченные администраторы могут проверять целостность всех конфигураций, связанных с безопасностью. | | | ✓ | |

## V14.2 Зависимости

Управление зависимостями имеет решающее значение для безопасной работы любого приложения любого типа. Отсутствие своевременного обновления устаревших или небезопасных зависимостей является основной причиной самых масштабных и дорого обошедшихся атак на сегодняшний день.

Примечание: Соответствие требованию 14.2.1 на уровне L1 относится к определению состава клиентских и прочих библиотек и компонентов, а не к более точному статическому анализу кода во время сборки или анализу зависимостей. Эти детали при необходимости могут быть выяснены устно.

| № | Описание | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **14.2.1** | Убедитесь, что все компоненты обновляются, желательно с помощью инструмента проверки зависимостей во время сборки или компиляции. ([C2](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓ | ✓ | ✓ | 1026 |
| **14.2.2** | Убедитесь, что удалены все ненужные функции, документация, примеры приложений и конфигураций. | ✓ | ✓ | ✓ | 1002 |
| **14.2.3** | Убедитесь, что если ресурсы приложения, такие как библиотеки JavaScript, CSS или web-шрифты, размещаются извне (в сети доставки контента (CDN) или у внешнего разработчика), то для проверки целостности этого ресурса используется Subresource Integrity (SRI). | ✓ | ✓ | ✓ | 829 |
| **14.2.4** | Убедитесь, что сторонние компоненты берутся из утвержденных, доверенных и постоянно поддерживаемых репозиториев. ([C2](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 829 |
| **14.2.5** | Убедитесь, что для всех используемых сторонних библиотек ведется спецификация программного обеспечения (SBOM). ([C2](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | |
| **14.2.6** | Убедитесь, что поверхность атаки сокращается за счет изоляции сторонних библиотек или инкапсуляции их функций таким образом, чтобы они демонстрировали приложению только требуемое поведение. ([C2](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 265 |

## V14.3 Непреднамеренное раскрытие информации о безопасности

Конфигурации для среды промышленной эксплуатации должны быть укреплены для защиты от распространенных атак, таких как консоли отладки, межсайтовые сценарии (XSS), удаленное включение файлов (RFI) а также для устранения тривиальных «уязвимостей» раскрытия информации, которые, к сожалению, являются приметой многих отчетов о тестировании на проникновение. Сами подобные уязвимости редко оцениваются как значительные, но они «приглашают друзей». Если их нет по умолчанию, это повышает уровень защиты, т.к. многие атаки не смогут увенчаться успехом.

| № | Описание | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **14.3.1** | [УДАЛЕНО, ДУБЛИРУЕТ 7.4.1] | | | | |
| **14.3.2** | Убедитесь, что в промышленной среде отключены режимы отладки web-сервера, сервера или платформы приложений, чтобы отключить функции отладки, консоль разработчика и исключить непреднамеренное раскрытие информации о безопасности. | ✓ | ✓ | ✓ | 497 |
| **14.3.3** | Убедитесь, что в HTTP-заголовках или HTTP-ответах не содержится информации о версии системных компонентов. | ✓ | ✓ | ✓ | 200 |

## V14.4 HTTP-заголовки безопасности

| № | Описание | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **14.4.1** | Убедитесь, что каждый HTTP-ответ содержит заголовок Content-Type. Если тип контента — text/*, /+xml или application/xml, то должна быть указана безопасная кодовая страница (например, charset=UTF-8 или ISO-8859-5). Контент должен соответствовать предоставленному заголовку Content-Type. | ✓ | ✓ | ✓ | 173 |
| **14.4.2** | Убедитесь, что все ответы API содержат заголовок Content-Disposition: attachment; filename="api.json" (или другое наименование файла, подходящее для этого типа контента). | ✓ | ✓ | ✓ | 116 |
| **14.4.3** | Убедитесь, что присутствует заголовок ответа Content Security Policy (CSP), который помогает ослабить воздействие XSS-атак через HTML, DOM, JSON или через инъекции JavaScript. | ✓ | ✓ | ✓ | 1021 |
| **14.4.4** | Убедитесь, что ответы содержат заголовок X-Content-Type-Options: nosniff. | ✓ | ✓ | ✓ | 116 |
| **14.4.5** | Убедитесь, что заголовок Strict-Transport-Security включен во все ответы и для всех поддоменов, например, Strict-Transport-Security: max-age=15778463; includeSubDomains. | ✓ | ✓ | ✓ | 523 |
| **14.4.6** | Убедитесь, что присутствует заголовок Referrer-Policy с уместным для приложения значением, чтобы избежать раскрытия недоверенным сторонам конфиденциальной информации в URL-адресе через заголовок Referer. | ✓ | ✓ | ✓ | 116 |
| **14.4.7** | Убедитесь, что содержимое web-приложения по умолчанию не может быть встроено на сторонний сайт, и что встраивание оригинальных ресурсов приложения возможно только с разрешения автора, используя соответствующие заголовки ответов Content-Security-Policy: frame-ancestors и X-Frame-Options. | ✓ | ✓ | ✓ | 1021 |

## V14.5 Проверка заголовка HTTP-запроса

| № | Описание | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **14.5.1** | Убедитесь, что сервер приложений принимает только те HTTP-методы, которые использует приложение/API, и регистрирует/предупреждает о любых запросах, недопустимых для контекста приложения. | ✓ | ✓ | ✓ | 749 |
| **14.5.2** | Убедитесь, что полученный заголовок Origin не используется для аутентификации или при принятии решений о контроле доступа, поскольку он может быть легко изменен злоумышленником. | ✓ | ✓ | ✓ | 346 |
| **14.5.3** | Убедитесь, что заголовок Access-Control-Allow-Origin при совместном использовании ресурсов (CORS) применяет для сопоставления строгий список разрешенных доверенных доменов и поддоменов, а не "null". | ✓ | ✓ | ✓ | 346 |
| **14.5.4** | Убедитесь, что приложением аутентифицируются HTTP-заголовки, добавляемые доверенным прокси-сервером или устройствами единого входа (SSO), например, через токен на предъявителя (bearer). | | ✓ | ✓ | 306 |

## Ссылки

Для дополнительной информации см. также:

* [OWASP Web Security Testing Guide 4.1: Testing for HTTP Verb Tampering](https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/07-Input_Validation_Testing/03-Testing_for_HTTP_Verb_Tampering.html)
* Добавление `Content-Disposition` к ответам API помогает предотвратить многие атаки, основанные на несогласованности в `MIME type` между клиентом и сервером, а опция `filename` помогает предотвратить [атаки Reflected File Download (RFD)](https://www.blackhat.com/docs/eu-14/materials/eu-14-Hafif-Reflected-File-Download-A-New-Web-Attack-Vector.pdf)
* [Content Security Policy Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Content_Security_Policy_Cheat_Sheet.html)
* [Exploiting CORS misconfiguration for BitCoins and Bounties](https://portswigger.net/blog/exploiting-cors-misconfigurations-for-bitcoins-and-bounties)
* [OWASP Web Security Testing Guide: Configuration and Deployment Management Testing](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/README.html)
* [Sandboxing third party components](https://cheatsheetseries.owasp.org/cheatsheets/Third_Party_Javascript_Management_Cheat_Sheet.html#sandboxing-content)
