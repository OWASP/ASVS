# V10 Вредоносный код

## Задачи контроля

Убедитесь, что ваш код удовлетворяет следующим концептуальным требованиям:

* Вредоносная активность надёжно и безопасно сдерживается, чтобы не повлиять на остальную часть приложения.
* Не имеет «бомб отложенного действия» или других атак, основанных на времени.
* Не «звонит домой» злонамеренным или неразрешённым адресатам.
* В нём нет лазеек, «пасхальных яиц», атак «салями», руткитов или несанкционированного кода, которым может управлять злоумышленник.

Обнаружение вредоносного кода является «доказательством от противного», в котором нельзя удостовериться полностью. Следует приложить все силы для обеспечения гарантии того, что ваш код не содержит встроенного вредоносного кода или недокументированных возможностей.

## V10.1 Целостность исходного кода

Лучшая защита от вредоносного кода — принцип «доверяй, но проверяй». Включение недокументированного или вредоносного кода во многих юрисдикциях является уголовным преступлением. Регламенты и процедуры должны четко определять санкции в отношении вредоносного кода.

Ведущие разработчики должны регулярно проводить анализ регистрации нового кода, особенно там, где есть доступ к системному времени, вводу-выводу или сетевым функциям.

| № | Описание | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **10.1.1** | Убедитесь, что используется инструмент анализа исходного кода, который может обнаруживать потенциально вредоносный код, например, манипуляции с системным временем, с файлами и сетевыми подключениями. | | | ✓ | 749 |

## V10.2 Поиск вредоносного кода

Вредоносный код встречается крайне редко, и его трудно обнаружить. Построчный просмотр кода вручную может помочь в поиске логических бомб, но даже самый опытный рецензент едва ли найдет вредоносный код, даже если знает, что он есть.

Соблюдение требований этого раздела невозможно без полного доступа к исходному коду, включая сторонние библиотеки.

| № | Описание | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **10.2.1** | Убедитесь, что исходный код приложения и сторонние библиотеки не содержат недокументированных возможностей по сбору и отправке данных пользователя неразрешённым адресатам. Если такие функции существуют, необходимо получить разрешение на эти действия и явное согласие пользователя, прежде чем собирать какие-либо данные. | | ✓ | ✓ | 359 |
| **10.2.2** | Убедитесь, что приложение не запрашивает ненужных или избыточных разрешений для функций, связанных с конфиденциальностью, например, доступ к контактам, сообщениям, истории просмотров и пр. или к датчикам, таким как камера, микрофон или местоположение. | | ✓ | ✓ | 272 |
| **10.2.3** | Убедитесь, что исходный код приложения и сторонних библиотек не содержит лазеек, таких как включенные в код и/или недокументированные учетные записи или ключи, обфускация кода, недокументированные бинарные объекты (blob), руткиты или средства защиты от отладки, или иные устаревшие, небезопасные или скрытые функции, которые могут быть использованы злонамеренно. | | | ✓ | 507 |
| **10.2.4** | Убедитесь, что исходный код приложения и сторонние библиотеки не содержат «бомб отложенного действия», выполнив поиск функций, связанных с датой и временем. | | | ✓ | 511 |
| **10.2.5** | Убедитесь, что исходный код приложения и сторонние библиотеки не содержат вредоносного кода, такого как атаки типа «нарезка салями», обход логики или «логические бомбы». | | | ✓ | 511 |
| **10.2.6** | Убедитесь, что исходный код приложения и сторонние библиотеки не содержат «пасхальных яиц» и других недокументированных функций. | | | ✓ | 507 |

## V10.3 Целостность приложения

Вредоносный код может быть включен и после развертывания приложения. Приложения должны защищать себя от распространенных атак, таких как выполнение неподписанного кода из недоверенных источников и захват доменов.

Соблюдение требований этого раздела, вероятно, будет регулярным занятием во время эксплуатации приложений.

| № | Описание | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **10.3.1** | Убедитесь, что если в приложении есть функция автоматического обновления клиента или сервера, то обновления должны быть получены по защищенным каналам и подписаны электронной подписью. Код обновления должен проверять подпись обновления до установки или применения обновления. | ✓ | ✓ | ✓ | 16 |
| **10.3.2** | Убедитесь, что приложение использует меры защиты целостности, такие как подпись кода или включаемых ресурсов (subresource integrity). Приложение не должно загружать или исполнять код из недоверенных источников, таких как загрузка компонентов, модулей, плагинов, кода или библиотек из Интернета. | ✓ | ✓ | ✓ | 353 |
| **10.3.3** | Убедитесь, что если приложение полагается на записи DNS или субдомены DNS, то оно контролирует возможный захват субдоменов злоумышленниками, например, после истечения срока делегирования доменных имен, устаревании указателей DNS или CNAME, в необновляемых проектах, в общедоступных репозиториях исходного кода или во временных облачных API, бессерверных функциях, или хранилищах (*autogen-bucket-id*.cloud.example.com и т.п.). Меры защиты включают регулярную проверку DNS-имен, используемых приложениями, на предмет истечения срока их делегирования или изменения владельца. | ✓ | ✓ | ✓ | 350 |

## Ссылки

* [Враждебный захват субдомена, Detectify Labs](https://labs.detectify.com/2014/10/21/hostile-subdomain-takeover-using-herokugithubdesk-more/)
* [Угон заброшенных поддоменов, часть 2, Detectify Labs](https://labs.detectify.com/2014/12/08/hijacking-of-abandoned-subdomains-part-2/)
