# V2 Аутентификация

Аутентификация — это действие по установлению или подтверждению подлинности кого-либо (или чего-либо) и того, что утверждения, сделанные человеком или устройством, верны, защищены от подмены и предотвращают восстановление или перехват паролей.

Когда ASVS был впервые опубликован, имя пользователя и пароль были наиболее распространенной формой аутентификации (за исключением систем, содержащих сведения, составляющие государственную тайну). Многофакторная аутентификация (МФА) была широко известна в узких кругах специалистов, но редко применялась. По мере увеличения количества взломов идея о том, что имена пользователей каким-то образом конфиденциальны, а пароли неизвестны, оказалась несостоятельной (вместе с мерами безопасности, которые на ней основывались). Например, [NIST 800-63](https://pages.nist.gov/800-63-3/) рассматривает имена пользователей и аутентификацию на основе знаний — Knowledge Based Authentication (KBA) — как общедоступную информацию; уведомления по SMS и электронной почте — как ["ограниченные" типы аутентификаторов](https://pages.nist.gov/800-63-FAQ/#q-b1); а все пароли — как предварительно взломанные. Эта реальность делает бесполезными аутентификаторы, основанные на знаниях, восстановление по SMS и электронной почте, историю паролей, сложность и контроль ротации. Эти меры и раньше были не очень полезными, часто вынуждая пользователей каждые несколько месяцев придумывать такие же слабые пароли, но когда счет взломанных учетных записей пошел на миллиарды, пришло время двигаться дальше.

Из всех глав ASVS больше всего изменились главы об аутентификации и управлении сессиями. Внедрение эффективной, основанной на фактических данных передовой практики для многих будет сложной задачей, и это совершенно нормально. Мы должны начать переход к пост-парольному будущему уже сейчас.

## NIST 800-63 — современный стандарт аутентификации, основанный на доказательствах

[NIST 800-63b](https://pages.nist.gov/800-63-3/sp800-63b.html) — современный, основанный на фактических данных стандарт, который представляет собой наилучшие из имеющихся рекомендаций, независимо от их применимости. Стандарт полезен для всех организаций по всему миру, но особенно актуален для государственных служб в США и тех, кто работает с ними.

Поначалу терминология NIST 800-63 может немного сбивать с толку, особенно если раньше вы пользовались только аутентификацией по имени пользователя и паролю. Чтобы описать достижения в области современной аутентификации необходимо ввести новую терминологию, которая станет общепринятой в будущем. Мы осознаем сложность ее понимания, пока сообщество не примет эти новые термины, поэтому в конце этой главы мы привели глоссарий, чтобы помочь вам. Мы перефразировали многие требования, чтобы лучше донести дух требования, а не его букву. Например, в ASVS используется термин «пароль», тогда как в NIST — «запоминаемый секрет».

Разделы ASVS V2 Аутентификация, V3 Управление сессиями, и, в меньшей степени, V4 Контроль доступа были адаптированы для соответствия с избранными мерами в NIST 800-63b, ориентированными на основные угрозы и часто эксплуатируемые недостатки аутентификации. Если требуется полное соответствие требованиям NIST 800-63, лучше обратиться непосредственно к NIST 800-63.

### Выбор подходящего уровня доверия (AAL) в NIST

В Стандарте исследования безопасности приложений мы попытались сопоставить ASVS L1 с требованиями NIST уровня доверия AAL1, L2 с AAL2 и L3 с AAL3. Однако выбор базовых мер в ASVS L1 не обязательно окажется правильным AAL для тестирования приложения или API. Например, если приложение относится к L3 или соответствует нормативным требованиям AAL3, следует выбрать L3 в главах V2 и V3 Управление сессиями. Выбор уровня доверия (AAL) для аутентификации, совместимого с NIST, должен соответствовать рекомендациям NIST 800-63b, изложенным в разделе *Выбор AAL* в [NIST 800-63b раздел 6.2](https://pages.nist.gov/800-63-3/sp800-63-3.html#AAL_CYOA).

## Условные обозначения

Приложения могут превосходить требования текущего уровня, особенно если современные механизмы аутентификации входят в план развития приложения. Ранее для ASVS требовалась обязательная МФА, а в NIST нет требования обязательности. Поэтому в этой главе мы использовали дополнительные обозначения, чтобы указать, где ASVS поощряет, но не требует контроля:

| Знак | Описание |
| :--: | :-- |
| | Не требуется |
| o | Рекомендуется |
| ✓ | Обязательно |

## V2.1 Парольная защита

Пароли, называемые в NIST 800-63 «запоминаемыми секретами», включают в себя пароли, PIN-коды, узоры разблокировки, выбор правильного изображения из набора и парольные фразы. Они обычно считаются «чем-то, что вы знаете» и часто используются в качестве однофакторных аутентификаторов. Существуют серьезные проблемы с дальнейшим использованием однофакторной аутентификации, включая миллиарды действительных имен пользователей и паролей, раскрытых в Интернете, стандартные или слабые пароли, радужные таблицы и упорядоченные словари наиболее распространенных паролей.

Приложения должны настоятельно рекомендовать пользователям включать многофакторную аутентификацию и позволять применять токены, которые у них уже есть, такие как FIDO или U2F, или ссылаться на поставщика услуг учетных данных (Credential Service Provider, CSP), который обеспечивает многофакторную аутентификацию.

CSP предоставляют федеративную идентификацию для пользователей. У пользователей часто бывает множество цифровых удостоверений у разных CSP, например корпоративное на Azure AD, Okta или Ping Identity, и личные на Яндекс, или VK, и это лишь некоторые из распространенных альтернатив. Этот список не является рекомендацией этих компаний или их услуг, а просто побуждает разработчиков учитывать тот факт, что многие пользователи имеют много цифровых удостоверений. Организации должны рассмотреть возможность интеграции с существующими учетными записями пользователей в соответствии с профилем риска, который определяется доверием к удостоверениям, предоставляемым каждым CSP. Например, маловероятно, что какой-нибудь госорган примет учетную запись из социальной сети в качестве входа в государственную информационную систему, поскольку легко создать поддельную или одноразовую учетную запись, в то время как компания, разрабатывающая мобильные игры, вполне может интегрироваться с основными платформами социальных сетей, чтобы увеличить базу активных игроков.

| № | Описание | L1 | L2 | L3 | CWE | NIST |
| :---: | :--- | :---: | :---:| :---: | :---: | :---: |
| **2.1.1** | Убедитесь, что устанавливаемые пользователем пароли имеют длину не менее 12 символов (после объединения пробелов, если они идут подряд). ([C6](https://owasp.org/www-project-proactive-controls/v3/en/c6-digital-identity.html)) | ✓ | ✓ | ✓ | [521](https://cwe.mitre.org/data/definitions/521.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.1.2** | Убедитесь, что разрешены пароли длиной не менее 64 символов и что пароли длиной более 128 символов запрещены. ([C6](https://owasp.org/www-project-proactive-controls/v3/en/c6-digital-identity.html)) | ✓ | ✓ | ✓ | [521](https://cwe.mitre.org/data/definitions/521.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.1.3** | Убедитесь, что отсутствует усечение пароля по длине. Идущие подряд несколько пробелов могут быть заменены одним. ([C6](https://owasp.org/www-project-proactive-controls/v3/en/c6-digital-identity.html)) | ✓ | ✓ | ✓ | [521](https://cwe.mitre.org/data/definitions/521.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.1.4** | Убедитесь, что в паролях разрешены любые печатные символы Unicode, включая нейтральные к языку символы, такие как пробелы и эмодзи. | ✓ | ✓ | ✓ | [521](https://cwe.mitre.org/data/definitions/521.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.1.5** | Убедитесь, что пользователи могут менять свой пароль. | ✓ | ✓ | ✓ | [620](https://cwe.mitre.org/data/definitions/620.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.1.6** | Убедитесь, что при изменении пароля требуется ввести текущий и новый пароль пользователя. | ✓ | ✓ | ✓ | [620](https://cwe.mitre.org/data/definitions/620.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.1.7** | Убедитесь (локально или с помощью внешнего API), что пароли, введенные при регистрации учетной записи, входе в систему или смене пароля, проверяются на вхождение в состав скомпрометированных (например, в 1000 или 10 000 наиболее распространенных). Для API при проверке следует использовать доказательство с нулевым разглашением или другой механизм, гарантирующий, что пароль не будет отправлен открытым текстом. Если пароль скомпрометирован, то приложение должно потребовать от пользователя ввести другой. ([C6](https://owasp.org/www-project-proactive-controls/v3/en/c6-digital-identity.html)) | ✓ | ✓ | ✓ | [521](https://cwe.mitre.org/data/definitions/521.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.1.8** | Убедитесь в наличии индикатора надежности пароля, который поможет пользователям установить более стойкий пароль. | ✓ | ✓ | ✓ | [521](https://cwe.mitre.org/data/definitions/521.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.1.9** | Убедитесь, что правила составления пароля не ограничивают допустимый тип символов. Не должно быть никаких требований к наличию символов в верхнем или нижнем регистре, цифр или специальным символов. ([C6](https://owasp.org/www-project-proactive-controls/v3/en/c6-digital-identity.html)) | ✓ | ✓ | ✓ | [521](https://cwe.mitre.org/data/definitions/521.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.1.10** | Убедитесь, что нет требований к периодической замене учетных данных или истории паролей. | ✓ | ✓ | ✓ | [263](https://cwe.mitre.org/data/definitions/263.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.1.11** | Убедитесь, что разрешены функции вставки пароля в соответствующие поля экранных форм, а также утверждены браузерные расширения по управлению паролями и/или менеджеры паролей. | ✓ | ✓ | ✓ | [521](https://cwe.mitre.org/data/definitions/521.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.1.12** | Убедитесь, что пользователь имеет возможность временно приоткрыть весь маскированный пароль, либо последний введенный символ (если такая функция не включена по умолчанию). | ✓ | ✓ | ✓ | [521](https://cwe.mitre.org/data/definitions/521.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |

Примечание: Цель предоставления пользователю возможности временно просматривать свой пароль или его последний символ состоит в том, чтобы повысить удобство ввода учетных данных, особенно для длинных паролей, парольных фраз и в менеджерах паролей.

## V2.2 Базовые требования

Для приложений, ориентированных на будущее необходима гибкость в отношении аутентификаторов.  Для включения дополнительных средств аутентификации в соответствии с предпочтениями пользователя, а также для планомерного вывода из эксплуатации устаревших или небезопасных средств аутентификации код приложения необходимо регулярно пересматривать.

NIST рассматривает email и SMS как ["ограниченные" типы аутентификаторов](https://pages.nist.gov/800-63-FAQ/#q-b1), и они, видимо, будут исключены из NIST 800-63, и, следовательно, из ASVS в будущих версиях. Приложения должны запланировать отказ от использования электронной почты или SMS при аутентификации.

| № | Описание | L1 | L2 | L3 | CWE | NIST |
| :---: | :--- | :---: | :---:| :---: | :---: | :---: |
| **2.2.1** | Убедитесь, что для снижения последствий от взлома учетных данных реализованы механизмы защиты от атак методом перебора и блокирования учетных записей. Такие механизмы включают запрет выбора наиболее распространенных скомпрометированных паролей, временную блокировку учетной записи, ограничение частоты запросов, CAPTCHA, увеличивающиеся интервалы между попытками, ограничение списка допустимых IP-адресов, или основанные на оценке рисков, например, ограничение по местоположению, времени входа и т.п. Убедитесь, что для одной учетной записи разрешено, не более 100 неудачных попыток в час. | ✓ | ✓ | ✓ | [307](https://cwe.mitre.org/data/definitions/307.html) | [5.2.2](https://pages.nist.gov/800-63-3/sp800-63b.html#throttle) / [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) / 5.1.4.2 / 5.1.5.2 |
| **2.2.2** | Убедитесь, что использование слабых механизмов аутентификации (таких как SMS и email) ограничивается проверкой второго фактора или подтверждением транзакций, а не заменой более безопасных механизмов. Убедитесь, что сначала предлагаются более надежные методы, а затем более слабые; что пользователи осведомлены о рисках; что приняты надлежащие меры для ограничения рисков компрометации учетной записи. | ✓ | ✓ | ✓ | [304](https://cwe.mitre.org/data/definitions/304.html) | [5.2.10](https://pages.nist.gov/800-63-3/sp800-63b.html#restricted) |
| **2.2.3** | Убедитесь, что после обновления учетных данных, например, сброса пароля, изменения электронной почты или адреса, входа в систему из неизвестного места, пользователям отправляются уведомления. Предпочтительно использование push-уведомлений, а не SMS или email, но при невозможности использования push-уведомлений  допустимы SMS или email, при условии, что в уведомлении не раскрывается конфиденциальная информация. | ✓ | ✓ | ✓ | [620](https://cwe.mitre.org/data/definitions/620.html) | |
| **2.2.4** | Убедитесь в устойчивости к фишингу. Для защиты используются многофакторная аутентификация; мобильные устройства с push-аутентификацией (позволяющие подтвердить или отклонить намерение пройти аутентификацию через push-уведомления). На более высоких уровнях AAL — сертификаты на стороне клиента. | | | ✓ | [308](https://cwe.mitre.org/data/definitions/308.html) | [5.2.5](https://pages.nist.gov/800-63-3/sp800-63b.html#verifimpers) |
| **2.2.5** | Убедитесь, что если провайдер учетных данных (CSP) и аутентифицирующее приложение разделены, между их конечными точками используется протокол mTLS с взаимной аутентификацией. | | | ✓ | [319](https://cwe.mitre.org/data/definitions/319.html) | 5.2.6 |
| **2.2.6** | Убедитесь в устойчивости к атакам повторного воспроизведения, требуя обязательного использования одноразовых паролей (OTP), криптографических аутентификаторов или проверочных кодов. | | | ✓ | [308](https://cwe.mitre.org/data/definitions/308.html) | [5.2.8](https://pages.nist.gov/800-63-3/sp800-63b.html#replay) |
| **2.2.7** | Убедитесь, что намерение пройти аутентификацию, подтверждается требованием ввести OTP или инициированным пользователем действием, например, нажатием кнопки на аппаратном ключе FIDO. | | | ✓ | [308](https://cwe.mitre.org/data/definitions/308.html) | [5.2.9](https://pages.nist.gov/800-63-3/sp800-63b.html#intent) |

## V2.3 Жизненный цикл аутентификатора

Аутентификаторы — это пароли, программные и аппаратные токены и биометрические устройства. Жизненный цикл аутентификаторов имеет решающее значение для безопасности приложения. Если зарегистрировать учетную запись без подтверждения ее подлинности, то она не вызовет большого доверия. Для сайтов социальных сетей такие в порядке вещей, но для безопасности банковских приложений внимание к регистрации и выдаче учетных данных и устройств имеет решающее значение.

Примечание: Пароли не должны иметь максимального срока действия или подлежать замене. Их следует регулярно проверять на предмет взлома, а не заменять.

| № | Описание | L1 | L2 | L3 | CWE | NIST |
| :---: | :--- | :---: | :---:| :---: | :---: | :---: |
| **2.3.1** | Убедитесь, что создаваемые системой начальные пароли или коды активации формируются криптографически случайным образом. Они ДОЛЖНЫ иметь длину не менее 6 символов и МОГУТ содержать буквы и цифры, а срок их действия истекает через короткий период времени. Нельзя допускать, чтобы начальный пароль становился долгосрочным. | ✓ | ✓ | ✓ | [330](https://cwe.mitre.org/data/definitions/330.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) / [A.3](https://pages.nist.gov/800-63-3/sp800-63b.html#appA) |
| **2.3.2** | Убедитесь, что поддерживается регистрация и использование предоставленных пользователем устройств аутентификации, таких как токены U2F или FIDO. | | ✓ | ✓ | [308](https://cwe.mitre.org/data/definitions/308.html) | 6.1.3 |
| **2.3.3** | Убедитесь, что для обновления аутентификаторов с ограниченым сроком действия инструкции по их замене направляются заблаговременно. | | ✓ | ✓ | [287](https://cwe.mitre.org/data/definitions/287.html) | 6.1.4 |

## V2.4 Хранение учетных данных

Архитекторам и разработчикам следует сверяться с этим разделом при создании или рефакторинге кода. Изложенные здесь требования можно полностью проверить, анализируя исходный код или с помощью модульных или интеграционных тестов безопасности. Тестирование на проникновение не сможет выявить ни одной из этих проблем.

Список утвержденных односторонних функций формирования ключей подробно описан в разделе [5.1.1.2 NIST 800-63 B](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver), и в [BSI Kryptographische Verfahren: Empfehlungen und Schlussell&auml;ngen (2018)](https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/Publikationen/TechnischeRichtlinien/TR02102/BSI-TR-02102.pdf?__blob=publicationFile). Вместо этих вариантов требования к алгоритмам и длине ключа можно взять из актуальных версий [национальных стандартов](https://tc26.ru/standarts/).

Требования этого раздела нельзя проверить пентестом, поэтому они не отмечены в L1. Однако этот раздел имеет жизненно важное значение для безопасности учетных данных в случае их кражи. Поэтому, если вы применяете ASVS в качестве руководства по архитектуре, разработке или чек-листа проверки исходного кода, пожалуйста, включите эти меры в L1 в вашей собственной версии.

| № | Описание | L1 | L2 | L3 | CWE | NIST |
| :---: | :--- | :---: | :---:| :---: | :---: | :---: |
| **2.4.1** | Убедитесь, что пароли хранятся в форме, устойчивой к атакам в режиме offline. Пароли ДОЛЖНЫ быть «засолены» и хешированы с использованием утвержденной односторонней функции формирования ключа или функции хеширования. При генерации хэша функция принимает на вход пароль, соль и фактор стоимости. ([C6](https://owasp.org/www-project-proactive-controls/v3/en/c6-digital-identity.html)) | | ✓ | ✓ | [916](https://cwe.mitre.org/data/definitions/916.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.4.2** | Убедитесь, что соль имеет как минимум 32 бит энтропии и выбирается произвольно, чтобы минимизировать коллизии значений соли между сохраненными хэшами. Для КАЖДОГО пароля должны хранится уникальное значение соли и результирующий хэш. ([C6](https://owasp.org/www-project-proactive-controls/v3/en/c6-digital-identity.html)) | | ✓ | ✓ | [916](https://cwe.mitre.org/data/definitions/916.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.4.3** | Убедитесь, что если используется функция PBKDF2, то количество итераций ДОЛЖНО быть настолько большим, насколько это позволяет производительность сервера верификации, но не менее 100 000 итераций. ([C6](https://owasp.org/www-project-proactive-controls/v3/en/c6-digital-identity.html)) | | ✓ | ✓ | [916](https://cwe.mitre.org/data/definitions/916.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.4.4** | Убедитесь, что коэффициент работы при использовании bcrypt ДОЛЖЕН быть настолько большим, насколько позволяет производительность сервера верификации, но не менее 10. ([C6](https://owasp.org/www-project-proactive-controls/v3/en/c6-digital-identity.html)) | | ✓ | ✓ | [916](https://cwe.mitre.org/data/definitions/916.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.4.5** | Убедитесь, что выполняется дополнительная итерация функции формирования ключа с использованием значения соли, которое является секретным и известно только верификатору. Соль формируется с помощью утвержденного генератора случайных битов в соответствии с [NIST SP 800-90Ar1](https://csrc.nist.gov/publications/detail/sp/800-90a/rev-1/final) и обеспечивается хотя бы минимальный уровень безопасности, указанный в последней редакции [NIST SP 800-131A](https://csrc.nist.gov/publications/detail/sp/800-131a/rev-2/final). Значение секретной соли ДОЛЖНО храниться отдельно от хэшированных паролей (в специализированном устройстве, например, в HSM (аппаратном модуле безопасности). | | ✓ | ✓ | [916](https://cwe.mitre.org/data/definitions/916.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |

Вместо или в дополнение к приведенным в этом документе стандартам США  могут использоваться [национальные стандарты](https://tc26.ru/standarts/).

## V2.5 Восстановление учетных данных

| № | Описание | L1 | L2 | L3 | CWE | NIST |
| :---: | :--- | :---: | :---:| :---: | :---: | :---: |
| **2.5.1** | Убедитесь, что сгенерированный системой начальный секрет активации или восстановления не отправляется пользователю в виде открытого текста. ([C6](https://owasp.org/www-project-proactive-controls/v3/en/c6-digital-identity.html)) | ✓ | ✓ | ✓ | [640](https://cwe.mitre.org/data/definitions/640.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.5.2** | Убедитесь, что не используются подсказки для проверки пароля или аутентификация на основе знаний (так называемые "секретные вопросы"). | ✓ | ✓ | ✓ | [640](https://cwe.mitre.org/data/definitions/640.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.5.3** | Убедитесь, что при восстановлении забытого пароля никоим образом не раскрывается текущий пароль. ([C6](https://owasp.org/www-project-proactive-controls/v3/en/c6-digital-identity.html)) | ✓ | ✓ | ✓ | [640](https://cwe.mitre.org/data/definitions/640.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.5.4** | Убедитесь, что отсутствуют неперсонифицированные учетные записи или учетные записи по умолчанию (например, «root», «admin», «sa», «guest» и т. п.). | ✓ | ✓ | ✓ | [16](https://cwe.mitre.org/data/definitions/16.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) / [A.3](https://pages.nist.gov/800-63-3/sp800-63b.html#appA) |
| **2.5.5** | Убедитесь, что при изменении фактора аутентификации пользователь был уведомлен об этом событии. | ✓ | ✓ | ✓ | [304](https://cwe.mitre.org/data/definitions/304.html) | 6.1.2.3 |
| **2.5.6** | Убедитесь, что пути восстановления пароля (Забыли пароль? и др.) используют безопасный механизм, например, OTP на основе времени (TOTP), мобильное push-уведомление или иной механизм передачи по дополнительному каналу. ([C6](https://owasp.org/www-project-proactive-controls/v3/en/c6-digital-identity.html)) | ✓ | ✓ | ✓ | [640](https://cwe.mitre.org/data/definitions/640.html) | [5.1.1.2](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecretver) |
| **2.5.7** | Убедитесь, что в случае потери OTP или любого другого фактора аутентификация выполняется с тем же уровнем безопасности, что и во время регистрации. | | ✓ | ✓ | [308](https://cwe.mitre.org/data/definitions/308.html) | 6.1.2.3 |

## V2.6 Проверочные коды

Проверочные коды – это предварительно сгенерированные списки секретных кодов, аналогичные номерам авторизации транзакций (TAN), кодам восстановления в социальных сетях или кодовым таблицам, содержащим набор случайных значений, безопасным образом распространяемые среди пользователей. Каждый код используется только один раз, и когда все они использованы, кодовая таблица становится недействительной. Этот тип аутентификаторов считается «чем-то, что у вас есть».

| № | Описание | L1 | L2 | L3 | CWE | NIST |
| :---: | :--- | :---: | :---:| :---: | :---: | :---: |
| **2.6.1** | Убедитесь, что проверочный код из кодовой таблицы можно использовать только один раз. | | ✓ | ✓ | [308](https://cwe.mitre.org/data/definitions/308.html) | [5.1.2.2](https://pages.nist.gov/800-63-3/sp800-63b.html#lusa) |
| **2.6.2** | Убедитесь, что проверочные коды имеют достаточную случайность (112 бит энтропии). Если их энтропия меньше 112 бит, они «засолены» уникальной и случайной 32-битной солью и хэшированы с помощью утвержденной односторонней функции хэширования. | | ✓ | ✓ | [330](https://cwe.mitre.org/data/definitions/330.html) | [5.1.2.2](https://pages.nist.gov/800-63-3/sp800-63b.html#lusa) |
| **2.6.3** | Убедитесь, что проверочные коды устойчивы к атакам offline. Например, что в них не используются предсказуемые значения. | | ✓ | ✓ | [310](https://cwe.mitre.org/data/definitions/310.html) | [5.1.2.2](https://pages.nist.gov/800-63-3/sp800-63b.html#lusa) |

## V2.7 Второй фактор аутентификации

В прошлом обычным механизмом проверки второго фактора аутентификации был email или SMS, содержащие ссылку для сброса пароля. Злоумышленники используют этот слабый механизм для сброса пароля, которые они хотят контролировать, например, захватывая учетную запись электронной почты жертвы, и используя обнаруженную там ссылку для установки собственного пароля. Есть способы обработки второго фактора и получше.

Безопасный второй фактор — это физическое устройство, которое может обмениваться данными с верификатором по отдельному безопасному каналу. Пример — push-уведомления на мобильные устройства. Этот фактор считается «чем-то, что у вас есть». Когда пользователь хочет пройти аутентификацию, проверяющее приложение отправляет сообщение напрямую или косвенно через сторонний сервис. Сообщение содержит код аутентификации (обычно это случайное шестизначное число или модальное диалоговое окно подтверждения). Проверяющее приложение ожидает получения кода аутентификации по основному каналу и сравнивает значения полученного хэша с хэшем отправленного кода аутентификации. Если они совпадают, то верификатор может считать, что пользователь прошел аутентификацию.

ASVS предполагает, что мало кто будет разрабатывать с нуля новые факторы аутентификации, такие как push-уведомления, и, таким образом, следующие меры ASVS применяются к таким верификаторам, как API и приложения аутентификации, реализации единого входа. При разработке новых аутентификаторов, см. [&sect; 5.1.3.1](https://pages.nist.gov/800-63-3/sp800-63b.html#ooba).

Электронная почта и VOIP в качестве второго фактора недопустимы. Аутентификация через ТСОП и SMS в настоящее время «ограничивается» в NIST и должна быть заменена на push-уведомления и т.п. Если вам необходимо использовать телефон или SMS как второй фактор, см. [&sect; 5.1.3.3](https://pages.nist.gov/800-63-3/sp800-63b.html#pstnOOB).

| № | Описание | L1 | L2 | L3 | CWE | NIST |
| :---: | :--- | :---: | :---:| :---: | :---: | :---: |
| **2.7.1** | Убедитесь, что по умолчанию не предлагается передавать второй фактор аутентификации открытым текстом через SMS или ТФОП. Т.е. сначала предлагаются более безопасные альтернативы, например, push-уведомления. | ✓ | ✓ | ✓ | [287](https://cwe.mitre.org/data/definitions/287.html) | [5.1.3.2](https://pages.nist.gov/800-63-3/sp800-63b.html#ooba) |
| **2.7.2** | Убедитесь, что срок действия запросов аутентификации, кодов или токенов, передаваемых по дополнительному каналу, истекает не позже, чем через 10 минут. | ✓ | ✓ | ✓ | [287](https://cwe.mitre.org/data/definitions/287.html) | [5.1.3.2](https://pages.nist.gov/800-63-3/sp800-63b.html#ooba) |
| **2.7.3** | Убедитесь, что запросы аутентификации, коды или токены, передаваемые по дополнительному каналу, можно использовать только один раз и только для исходного запроса аутентификации. | ✓ | ✓ | ✓ | [287](https://cwe.mitre.org/data/definitions/287.html) | [5.1.3.2](https://pages.nist.gov/800-63-3/sp800-63b.html#ooba) |
| **2.7.4** | Убедитесь, что проверяющая и проверяемая стороны взаимодействуют по отдельному защищенному каналу. | ✓ | ✓ | ✓ | [523](https://cwe.mitre.org/data/definitions/523.html) | [5.1.3.2](https://pages.nist.gov/800-63-3/sp800-63b.html#ooba) |
| **2.7.5** | Убедитесь, что проверяющая сторона сохраняет только хешированную версию кода аутентификации. | | ✓ | ✓ | [256](https://cwe.mitre.org/data/definitions/256.html) | [5.1.3.2](https://pages.nist.gov/800-63-3/sp800-63b.html#ooba) |
| **2.7.6** | Убедитесь, что код аутентификации формируется криптографическим генератором случайных чисел, и содержит не менее 20 бит энтропии (обычно достаточно шестизначного случайного числа). | | ✓ | ✓ | [310](https://cwe.mitre.org/data/definitions/310.html) | [5.1.3.2](https://pages.nist.gov/800-63-3/sp800-63b.html#ooba) |

## V2.8 OTP

Однофакторные одноразовые пароли (OTP) — это физические или программные токены, которые отображают постоянно меняющееся псевдослучайное одноразовые значение. Эти устройства делают фишинг (т.е. выдачу себя за другое лицо) трудным, но не невозможным. Этот тип аутентификатора считается «чем-то, что у вас есть». Многофакторные токены аналогичны однофакторным одноразовым паролям, но требуют ввода действующего PIN-кода, биометрической разблокировки, USB-токена, сопряжения по NFC или некоторого дополнительного значения (например, калькулятора подписи транзакций) для создания одноразового пароля.

| № | Описание | L1 | L2 | L3 | CWE | NIST |
| :---: | :--- | :---: | :---:| :---: | :---: | :---: |
| **2.8.1** | Убедитесь, что основанные на времени одноразовые пароли (OTP) имеют конечный срок действия. | ✓ | ✓ | ✓ | [613](https://cwe.mitre.org/data/definitions/613.html) | [5.1.4.2](https://pages.nist.gov/800-63-3/sp800-63b.html#sfotpa) / [5.1.5.2](https://pages.nist.gov/800-63-3/sp800-63b.html#mfotpa) |
| **2.8.2** | Убедитесь, что симметричные ключи, используемые для проверки отправленных одноразовых паролей, надежно защищены, например, с помощью аппаратного модуля безопасности (HSM) или безопасного хранилища ключей. предоставляемого операционной системой. | | ✓ | ✓ | [320](https://cwe.mitre.org/data/definitions/320.html) | [5.1.4.2](https://pages.nist.gov/800-63-3/sp800-63b.html#sfotpa) / [5.1.5.2](https://pages.nist.gov/800-63-3/sp800-63b.html#mfotpa) |
| **2.8.3** | Убедитесь, что при создании, заполнении и проверке одноразовых паролей используются утвержденные криптографические алгоритмы. | | ✓ | ✓ | [326](https://cwe.mitre.org/data/definitions/326.html) | [5.1.4.2](https://pages.nist.gov/800-63-3/sp800-63b.html#sfotpa) / [5.1.5.2](https://pages.nist.gov/800-63-3/sp800-63b.html#mfotpa) |
| **2.8.4** | Убедитесь, что одноразовый пароль на основе времени можно использовать только один раз в течение срока действия. | | ✓ | ✓ | [287](https://cwe.mitre.org/data/definitions/287.html) | [5.1.4.2](https://pages.nist.gov/800-63-3/sp800-63b.html#sfotpa) / [5.1.5.2](https://pages.nist.gov/800-63-3/sp800-63b.html#mfotpa) |
| **2.8.5** | Убедитесь, что если многофакторный OTP-токен на основе времени используется повторно в течение срока действия, то это событие регистрируется, токен не принимается, а владельцу устройства направляется уведомление. | | ✓ | ✓ | [287](https://cwe.mitre.org/data/definitions/287.html) | [5.1.5.2](https://pages.nist.gov/800-63-3/sp800-63b.html#mfotpa) |
| **2.8.6** | Убедитесь, что физический генератор однофакторных одноразовых паролей может быть отозван в случае его кражи или утери. Убедитесь, что отзыв вступает в силу немедленно во всех сессиях, в которых выполнен вход, независимо от местоположения. | | ✓ | ✓ | [613](https://cwe.mitre.org/data/definitions/613.html) | 5.2.1 |
| **2.8.7** | Убедитесь, что биометрические факторы аутентификации можно использовать только в качестве дополнительных, в сочетании с тем, что у вас есть, или с чем-то, что вы знаете. | | o | ✓ | [308](https://cwe.mitre.org/data/definitions/308.html) | [5.2.3](https://pages.nist.gov/800-63-3/sp800-63b.html#biometric_use) |

## V2.9 Криптографический верификатор

Криптографические ключи безопасности — это смарт-карты или ключи FIDO, к которым пользователь должен подключить или связать криптографическое устройство с компьютером для завершения аутентификации. Верификатор отправляет одноразовый запрос криптографическому устройству или приложению, которые вычисляют ответ на основе хранимого в тайне криптографического ключа.

Требования к однофакторным и многофакторным криптографическим устройствам и приложениям одинаковы, поскольку успешная проверка криптографического аутентификатора подтверждает обладание фактором аутентификации.

| № | Описание | L1 | L2 | L3 | CWE | NIST |
| :---: | :--- | :---: | :---:| :---: | :---: | :---: |
| **2.9.1** | Убедитесь, что криптографические ключи, используемые при проверке, хранятся в тайне и защищены от разглашения, например с помощью доверенного платформенного модуля (TPM) или аппаратного модуля безопасности (HSM) или службы ОС, которая может использовать это защищенное хранилище. | | ✓ | ✓ | [320](https://cwe.mitre.org/data/definitions/320.html) | [5.1.7.2](https://pages.nist.gov/800-63-3/sp800-63b.html#sfcdv) |
| **2.9.2** | Убедитесь, что одноразовая случайная строка (nonce) в запросе имеет длину не менее 64 бит и является уникальной статистически или в течение срока службы криптографического устройства. | | ✓ | ✓ | [330](https://cwe.mitre.org/data/definitions/330.html) | [5.1.7.2](https://pages.nist.gov/800-63-3/sp800-63b.html#sfcdv) |
| **2.9.3** | Убедитесь, что при создании и проверке используются утвержденные криптографические алгоритмы. | | ✓ | ✓ | [327](https://cwe.mitre.org/data/definitions/327.html) | [5.1.7.2](https://pages.nist.gov/800-63-3/sp800-63b.html#sfcdv) |

## V2.10 Технические учетные записи

Этот раздел не поддается тестированию на проникновение, поэтому не имеет требований L1. Однако, если у вас в архитектуре, разработке или анализе безопасного кода используются секреты, пожалуйста, рассматривайте программное хранилище (такое как доверенное хранилище ключей в Java) как минимальное требование на первом уровне. Хранение секретов в открытом виде недопустимо ни при каких обстоятельствах.

| № | Описание | L1 | L2 | L3 | CWE | NIST |
| :---: | :--- | :---: | :---:| :---: | :---: | :---: |
| **2.10.1** | Убедитесь, что секреты технических учетных записей не зависят от неизменных учетных данных, таких как пароли, ключи API или неперсонифицированные учетные записи с привилегированным доступом. | | ОС | HSM | [287](https://cwe.mitre.org/data/definitions/287.html) | [5.1.1.1](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecret) |
| **2.10.2** | Убедитесь, что если для аутентификации технической учетной записи (ТУЗ) требуется пароль, то эта ТУЗ не является учетной записью по умолчанию. Например, во время установки иногда используются root /root или admin / admin. | | ОС | HSM | [255](https://cwe.mitre.org/data/definitions/255.html) | [5.1.1.1](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecret) |
| **2.10.3** | Убедитесь, что пароли хранятся с достаточной защитой для предотвращения атак восстановления offline, включая доступ к локальной системе. | | ОС | HSM | [522](https://cwe.mitre.org/data/definitions/522.html) | [5.1.1.1](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecret) |
| **2.10.4** | Убедитесь, что пароли, строки подключения к базам данных и внешним системам, векторы инициализации и внутренние секреты, а также ключи API хранятся в тайне, и не включаются в исходный код, не хранятся в репозиториях исходного кода. Такое хранилище ДОЛЖНО противостоять атакам в режиме offline. Для хранения паролей рекомендуется использовать безопасное хранилище программных ключей (L1), аппаратный TPM или HSM (L3). | | ОС | HSM | [798](https://cwe.mitre.org/data/definitions/798.html) | |

## Дополнительные требования для госучреждений США

У госучреждений в США есть обязательные требования, касающиеся NIST 800-63. Стандарт исследования безопасности приложений всегда старался охватить те 80% мер, которые применимы почти ко всем приложениям, а не те 20%, которые имеют ограниченную применимость. Сам ASVS является подмножеством NIST 800-63, особенно для уровней IAL1/2 и AAL1/2, но не полностью заменяет его, особенно в отношении уровней IAL3/AAL3.

Мы настоятельно рекомендуем госучреждениям США изучить и внедрить у себя NIST 800-63 во всей его полноте.

## Определения и сокращения

| Термин | Определение |
| -- | -- |
| CSP | Поставщик услуг учетных данных (Credential Service Provider) также называемый поставщиком цифровых удостоверений (Identity Provider) |
| Аутентификатор | Код, который подтверждает подлинность пароля, токена, МФА, федеративного утверждения и т.д. |
| Верификатор | «Сущность, которая подтверждает личность заявителя, удостоверяя, что он обладает одним или двумя аутентификаторами с использованием протокола аутентификации. Для этого верификатору также может потребоваться проверить учетные данные, которые связывают аутентификатор(ы) с идентификатором подписчика и проконтролировать их статус" |
| OTP | Одноразовый пароль (One-time password) |
| SFA | Однофакторные аутентификаторы (Single-factor authenticators), например, то, что вы знаете (запомненные секреты, пароли, парольные фразы, PIN-коды), то, чем вы являетесь (биометрические данные, отпечатки пальцев, сканирование лица) или то, что у вас есть (токены OTP, криптографическое устройство, такое как смарт-карта). |
| МФА | Многофакторная аутентификация (Multi-factor authentication, MFA), включающая два или более одиночных фактора. |

## Источники

Для дополнительной информации см. также:

* [NIST 800-63 - Digital Identity Guidelines](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63-3.pdf)
* [NIST 800-63 A - Enrollment and Identity Proofing](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63a.pdf)
* [NIST 800-63 B - Authentication and Lifecycle Management](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63b.pdf)
* [NIST 800-63 C - Federation and Assertions](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63c.pdf)
* [NIST 800-63 FAQ](https://pages.nist.gov/800-63-FAQ/)
* [OWASP Testing Guide 4.0: Testing for Authentication](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/04-Authentication_Testing/README.html)
* [OWASP Cheat Sheet - Password storage](https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html)
* [OWASP Cheat Sheet - Forgot password](https://cheatsheetseries.owasp.org/cheatsheets/Forgot_Password_Cheat_Sheet.html)
* [OWASP Cheat Sheet - Choosing and using security questions](https://cheatsheetseries.owasp.org/cheatsheets/Choosing_and_Using_Security_Questions_Cheat_Sheet.html)
