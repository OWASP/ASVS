# ت7: التسجيل ومعالجة الخطأ

## الهدف من ضوابط الأمان

الهدف الأساسي من معالجة الأخطاء error handling والتسجيل logging هو توفير معلومات مفيدة للمستخدم والمسؤولين وفرق الاستجابة للحوادث. ليس الهدف هو الحصول على كميات هائلة من السجلات ، ولكن سجلات عالية الجودة تتضمن معلومات مفيدة وبارزة.

غالبًا ما تحتوي السجلات عالية الجودة على بيانات حساسة ، ويجب حمايتها وفقًا لقوانين أو توجيهات خصوصية البيانات المحلية. يجب أن يشمل ذلك:

* عدم جمع أو تسجيل المعلومات الحساسة ما لم يكن ذلك مطلوبًا على وجه التحديد.
* التأكد من التعامل مع جميع المعلومات المسجلة بشكل آمن ومحمي وفقًا لتصنيف البيانات الخاص بها.
* ضمان عدم تخزين السجلات إلى الأبد ، ولكن لها عمر مطلق أقصر ما يمكن.

إذا كانت السجلات تحتوي على بيانات خاصة أو حساسة ، يختلف تعريفها من بلد إلى آخر ، فإن السجلات تصبح من أكثر المعلومات حساسية التي يحتفظ بها التطبيق وبالتالي جذابة للغاية للمهاجمين في حد ذاتها.

من المهم أيضًا التأكد من فشل التطبيق بشكل آمن وأن الأخطاء لا تكشف عن معلومات غير ضرورية.

## ق1.7 محتوى السجل

يعد تسجيل المعلومات الحساسة أمرًا خطيرًا - حيث يتم تصنيف السجلات بنفسها ، مما يعني ضرورة تشفيرها وإخضاعها لسياسات الاحتفاظ ويجب الكشف عنها في عمليات تدقيق الأمان. تأكد من الاحتفاظ بالمعلومات الضرورية فقط في السجلات ، وبالتأكيد لا توجد عمليات دفع أو بيانات اعتماد (بما في ذلك الرموز المميزة للجلسة) أو معلومات حساسة أو معلومات شخصية.

إن ق1.7 يغطي OWASP Top 10 2017:A10. وكلا القسمين غير قابلين لاختبار الاختراق ، فهو مهم من أجل:

* ضمان امتثال المطورين الكامل لهذا القسم ، كما لو تم تعيين جميع العناصر على أنها L1.
* تحقق مختبرو الاختراق من الامتثال الكامل لجميع العناصر في ق1.7 عبر المقابلة أو لقطات الشاشة أو التأكيد assertion.

| # | التوصيف | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **1.1.7** | تحقق من أن التطبيق لا يسجل بيانات الاعتماد أو تفاصيل عمليات الدفع. يجب تخزين الرموز المميزة للجلسة فقط في السجلات في شكل مجزأ hashed بطريقة لا يمكن الرجوع فيها irreversible. ([C9, C10](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓ | ✓ | ✓ | 532 |
| **2.1.7** | تحقق من أن التطبيق لا يسجل بيانات حساسة أخرى على النحو المحدد بموجب قوانين الخصوصية المحلية أو سياسة الأمان ذات الصلة. ([C9](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓ | ✓ | ✓ | 532 |
| **3.1.7** | تحقق من أن التطبيق يسجل الأحداث المتعلقة بالأمان بما في ذلك أحداث المصادقة الناجحة والفاشلة وفشل التحكم في الوصول وفشل إلغاء التسلسل وفشل التحقق من صحة المدخلات. ([C5, C7](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 778 |
| **4.1.7** |تحقق من أن كل سجل حدث log event  يتضمن المعلومات الضرورية التي من شأنها أن تسمح بإجراء تحقيق مفصل للجدول الزمني عند وقوع الحدث. ([C9](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 778 |

## ق2.7 معالجة السجل

يعد التسجيل في الوقت المناسب أمرًا بالغ الأهمية لأحداث التدقيق والفرز triage والتصعيد escalation. تأكد من أن سجلات التطبيق واضحة ويمكن مراقبتها وتحليلها بسهولة إما محليًا أو يتم إرسالها إلى نظام مراقبة عن بُعد remote monitoring system.

إن ق2.7 يغطي OWASP Top 10 2017:A10. As 2017:A10. وكلا القسمين غير قابلين لاختبار الاختراق ، فهو مهم من أجل:

* ضمان امتثال المطورين الكامل لهذا القسم ، كما لو تم تعيين جميع العناصر على أنها L1.
* تحقق مختبرو الاختراق من الامتثال الكامل لجميع العناصر في ق1.7 عبر المقابلة أو لقطات الشاشة أو التأكيد assertion.

| # | التوصيف | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **1.2.7** | تحقق من تسجيل جميع قرارات المصادقة authentication decisions ، دون تخزين الرموز المميزة للجلسة أو كلمات المرور الحساسة. يجب أن يتضمن ذلك الطلبات مع الـ metadata ذات الصلة اللازمة للتحقيقات الأمنية security investigations. | | ✓ | ✓ | 778 |
| **2.2.7** | تحقق من إمكانية تسجيل جميع قرارات التحكم في الوصول وتسجيل جميع القرارات الفاشلة. يجب أن يتضمن ذلك الطلبات مع الـ metadata ذات الصلة اللازمة للتحقيقات الأمنية. | | ✓ | ✓ | 285 |

## ق3.7 متطلبات حماية السجل

السجلات التي يمكن تعديلها أو حذفها بشكل طفيف لا تفيد في التحقيقات والملاحقات القضائية. قد يؤدي الكشف عن السجلات إلى كشف التفاصيل الداخلية حول التطبيق أو البيانات التي يحتوي عليها. يجب توخي الحذر عند حماية السجلات من الكشف أو التعديل أو الحذف غير المصرح به.

| # | التوصيف | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **1.3.7** | تحقق من أن جميع مكونات التسجيل تقوم بترميز البيانات بشكل مناسب لمنع حقن السجل. ([C9](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 117 |
| **2.3.7** | [تم حذفها ، مكررة عن 1.3.7] | | | | |
| **3.3.7** | تحقق من أن سجلات الأمان محمية من الوصول والتعديل غير المصرح به. ([C9](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 200 |
| **4.3.7** | تحقق من مزامنة مصادر الوقت  time sourcesمع الوقت والمنطقة الزمنية الصحيحة. ضع في اعتبارك وبشكل صارم التسجيل في التوقيت العالمي المنسق فقط إذا كانت الأنظمة عالمية للمساعدة في تحليل الأدلة الرقمية بعد الحادث. ([C9](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | |

ملاحظة: من الصعب اختبار ومراجعة ترميز السجل (1.3.7) باستخدام أدوات ديناميكية آلية واختبارات الاختراق ، ولكن يجب على مهندسي المعمارية والمطورين ومراجعي الشيفرة المصدرية اعتباره من متطلبات المستوى 1.

## ق4.7 معالجة الأخطاء

الغرض من معالجة الأخطاء هو السماح للتطبيق بتوفير الأحداث الأمنية ذات الصلة للمراقبة والفرز traige والتصعيد. ليس الغرض هو توليد سجلات. عند تسجيل الأحداث المتعلقة بالأمان ، تأكد من تحقق الغاية من وجود السجل ، وأنه يمكن تمييزه بواسطة SIEM أو برامج التحليل.

| # | التوصيف | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **1.4.7** | تحقق من ظهور رسالة عامة عند حدوث خطأ غير متوقع أو حساس للأمان ، من المحتمل أن يكون بمعرف فريد يمكن لموظفي الدعم استخدامه للتحقيق. ([C10](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓ | ✓ | ✓ | 210 |
| **2.4.7** | تحقق من ظهور رسالة عامة عند حدوث خطأ غير متوقع أو حساس للأمان ، من المحتمل أن يكون بمعرف فريد يمكن لموظفي الدعم استخدامه للتحقيق. ([C10](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 544 |
| **3.4.7** | تحقق من تعريف معالج الأخطاء "الملاذ الأخير last resort" والذي سيلتقط كافة الاستثناءات التي لم تتم معالجتها. ([C10](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 431 |

ملاحظة: لا تدعم لغات معينة ، مثل Swift و Go - ومن خلال ممارسة التصميم الشائعة - والعديد من اللغات الوظيفية ، الاستثناءات أو معالجات أحداث الملاذ الأخير last resort. في هذه الحالة ، يجب على مهندسي المعمارية والمطورين استخدام نمط أو لغة أو طريقة مريحة لإطار العمل لضمان أن التطبيقات يمكنها التعامل بأمان مع الأحداث الاستثنائية أو غير المتوقعة أو المتعلقة بالأمان.

## المراجع

لمزيد من المعلومات، يمكن أيضاً الاطلاع على:

* [OWASP Testing Guide 4.0 content: Testing for Error Handling](https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/08-Testing_for_Error_Handling/README.html)
* [OWASP Authentication Cheat Sheet section about error messages](https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html#authentication-and-error-messages)
