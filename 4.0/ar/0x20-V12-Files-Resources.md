# ت12: الملفات والموارد

## الهدف من ضوابط الأمان

تأكد من أن التطبيق الذي يتم التحقق منه يفي بالمتطلبات عالية المستوى التالية:

* يجب التعامل مع بيانات الملف غير الموثوق Untrusted file data  بطريقة آمنة.
* يتم تخزين بيانات الملف غير الموثوق بها التي تم الحصول عليها من مصادر غير موثوق بها خارج مسار جذر الويب web root  وبأذونات محدودة limited permissions.

## ق1.12 رفع الملف

على الرغم من أن القنابل المضغوطة zip bombs  قابلة للاختبار بشكل كبير باستخدام تقنيات اختبار الاختراق ، إلا أنها تعتبر L2 وما فوق لتشجيع التفكير في التصميم والتطوير من خلال اختبار يدوي دقيق ، ولتجنب اختبار الاختراق اليدوي الآلي أو غير الماهر لحالة رفض الخدمة.

| # | التوصيف | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **1.1.12** | تحقق من أن التطبيق لن يقبل الملفات الكبيرة التي قد تملأ مساحة التخزين أو تتسبب في تعطيل الخدمة. | ✓ | ✓ | ✓ | 400 |
| **2.1.12** | تحقق من أن التطبيق يتحقق من الملفات المضغوطة (مثل zip و gz و docx و odt) مقابل الحد الأقصى المسموح به للحجم غير المضغوط ومقابل الحد الأقصى لعدد الملفات قبل فك ضغط الملف. | | ✓ | ✓ | 409 |
| **3.1.12** | تحقق من فرض الحصة النسبية لحجم الملف file size quota  والحد الأقصى لعدد الملفات لكل مستخدم لضمان عدم تمكن مستخدم واحد من ملء التخزين بعدد كبير جدًا من الملفات أو بالملفات الكبيرة جدًا. | | ✓ | ✓ | 770 |

## ق2.12 سلامة الملف

| # | التوصيف | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **1.2.12** | Verify that files obtained from untrusted sources are validated to be of expected type based on the file's content. | | ✓ | ✓ | 434 |

## ق3.12 تنفيذ الملف

| # | التوصيف | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **1.3.12** | تحقق من أن بيانات تعريف لاسم الملف filename metadata التي يرسلها المستخدم لا يتم استخدامها مباشرة بواسطة أنظمة ملفات النظام أو إطار العمل وأن واجهة برمجة تطبيقات URL (URL API) تستخدم للحماية من اجتياز المسار path traversal. | ✓ | ✓ | ✓ | 22 |
| **2.3.12** | تحقق من صحة بيانات تعريف لاسم الملف filename metadata المقدمة من المستخدم أو تجاهلها لمنع الكشف عن الملفات المحلية (Local File Inclusion LFI) أو إنشائها أو تحديثها أو إزالتها. | ✓ | ✓ | ✓ | 73 |
| **3.3.12** | تأكد من التحقق من صحة بيانات التعريف لاسم الملف filename metadata المقدمة من المستخدم أو تجاهلها لمنع الكشف عن الملفات البعيدة أو تنفيذها عبر هجمات تضمين الملفات عن بُعد Remote File Inclusion (RFI) أو هجمات تزوير الطلب من جانب الخادم Server-side Request Forgery (SSRF). | ✓ | ✓ | ✓ | 98 |
| **4.3.12** | تحقق من أن التطبيق يحمي من تنزيل الملف الانعكاسي Reflective File Download (RFD)  عن طريق التحقق من صحة أو تجاهل أسماء الملفات التي يرسلها المستخدم في بارامتر JSON أو JSONP أو عنوان URL ، ويجب ضبط قيمة رأس استجابة response Content-Type header  بـ text/plain ، ورأس Content-Disposition يجب أن يكون له اسم ملف ثابت. | ✓ | ✓ | ✓ | 641 |
| **5.3.12** | تحقق من أن بيانات التعريف للملف غير الموثوق بها لا تُستخدم مباشرةً مع واجهة برمجة تطبيقات النظام أو المكتبات ، للحماية من حقن أوامر نظام التشغيل OS command injection. | ✓ | ✓ | ✓ | 78 |
| **6.3.12** | تحقق من أن التطبيق لا يتضمن وظائف من مصادر غير موثوق بها ولا ينفذها، مثل شبكات توزيع المحتوى التي لم يتم التحقق منها unverified content distribution networks  ، أو مكتبات JavaScript ، أو مكتبات node npm ، أو مكتبات DLL من جانب الخادم. | | ✓ | ✓ | 829 |

## ق4.12 تخزين الملف

| # | التوصيف | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **1.4.12** | تحقق من أن الملفات التي تم الحصول عليها من مصادر غير موثوقة مخزنة خارج جذر الويب web root ، بأذونات محدودة limited permissions. | ✓ | ✓ | ✓ | 552 |
| **2.4.12** | تحقق من أن الملفات التي تم الحصول عليها من مصادر غير موثوقة يتم فحصها بواسطة مضادات الفيروسات antivirus scanners  لمنع تحميل وتخديم محتوى ضار معروف. | ✓ | ✓ | ✓ | 509 |

## ق5.12 تحميل الملف

| # | التوصيف | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **1.5.12** | تحقق من تكوين طبقة الويب web tier  لخدمة الملفات ذات امتدادات محددة لمنع تسرب المعلومات أو الشيفرة المصدرية  بشكل غير مقصود. على سبيل المثال ، يجب حظر ملفات النسخ الاحتياطي (مثل .bak) وملفات العمل المؤقتة (مثل .swp) والملفات المضغوطة (.zip و .tar.gz وما إلى ذلك) وغيرها من الامتدادات التي يشيع استخدامها بواسطة المحررين ما لم يكن ذلك مطلوبًا. | ✓ | ✓ | ✓ | 552 |
| **2.5.12** | تحقق من أن الطلبات المباشرة للملفات التي تم تحميلها لن يتم تنفيذها أبدًا كمحتوى HTML / JavaScript. | ✓ | ✓ | ✓ | 434 |

## ق6.12 حماية SSRF

| # | التوصيف | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **1.6.12** | تحقق من تكوين خادم الويب أو التطبيق بقائمة سماحية allow list  من الموارد أو الأنظمة التي يمكن للخادم إرسال الطلبات إليها أو تحميل البيانات / الملفات منها. | ✓ | ✓ | ✓ | 918 |

## المراجع

لمزيد من المعلومات، يمكن أيضاً الاطلاع على:

* [File Extension Handling for Sensitive Information](https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload)
* [Reflective file download by Oren Hafif](https://www.trustwave.com/Resources/SpiderLabs-Blog/Reflected-File-Download---A-New-Web-Attack-Vector/)
* [OWASP Third Party JavaScript Management Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Third_Party_Javascript_Management_Cheat_Sheet.html)
