# ت6: التشفير المخزن

## الهدف من ضوابط الأمان

تأكد من أن التطبيق الذي يتم التحقق منه يفي بالمتطلبات عالية المستوى التالية:

* تفشل جميع وحدات التشفير بطريقة آمنة ويتم التعامل مع الأخطاء بشكل صحيح.
* يتم استخدام مولد رقم عشوائي مناسب.
* تتم إدارة الوصول إلى المفاتيح بشكل آمن.

## ق1.6 تصنيف البيانات

أهم الأصول هي البيانات التي تتم معالجتها أو تخزينها أو نقلها بواسطة تطبيق ما. قم دائمًا بإجراء تقييم لتأثير الخصوصية privacy impact assessment لتصنيف احتياجات حماية البيانات لأي بيانات مخزنة بشكل صحيح.

| # | التوصيف | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **1.1.6** | تحقق من أن البيانات الخاصة المنظمة privacy impact assessment مخزنة بشكل مشفر أثناء الراحة at rest، مثل معلومات التعريف الشخصية Personally Identifiable Information (PII) أو المعلومات الشخصية الحساسة أو البيانات التي يُحتمل أن تكون خاضعة للائحة العامة لحماية البيانات (GDPR) الخاصة بالاتحاد الأوروبي EU's GDPR. | | ✓ | ✓ | 311 |
| **2.1.6** | تحقق من أن البيانات الصحية المنظمة regulated health data  مخزنة بشكل مشفر أثناء الراحة، مثل السجلات الطبية أو تفاصيل الجهاز الطبي أو سجلات البحث مجهولة المصدر. | | ✓ | ✓ | 311 |
| **3.1.6** | تحقق من أن البيانات المالية المنظمة regulated financial data يتم تخزينها مشفرة أثناء الراحة ، مثل الحسابات المالية أو التخلف عن السداد أو تاريخ الائتمان أو السجلات الضريبية أو سجل الدفع أو المستفيدين أو سجلات البحث أو السوق مجهولة المصدر. | | ✓ | ✓ | 311 |

## ق2.6 الخوارزميات

توضح التطورات الحديثة في التشفير أن الخوارزميات وأطوال المفاتيح الآمنة سابقًا لم تعد آمنة أو كافية لحماية البيانات. لذلك ، ينبغي أن يكون من الممكن تغيير الخوارزميات. 

على الرغم من أن هذا القسم لا يتم اختباره بسهولة ، إلا أن المطورين يجب أن يعتبروا هذا القسم بأكمله إلزاميًا على الرغم من أن L1 مفقود من معظم العناصر.

| # | التوصيف | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **1.2.6** | تحقق من أن جميع وحدات التشفيرcryptographic modules  تفشل بشكل آمن ، وأن الأخطاء يتم معالجتها بطريقة لا تتيح هجمات Padding Oracle. | ✓ | ✓ | ✓ | 310 |
| **2.2.6** | تحقق من استخدام خوارزميات التشفير والأنماط modes والمكتبات التي أثبتت جدواها في الصناعة أو المعتمدة من الحكومة ، بدلاً من التشفير المخصص المبرمَج custom coded cryptography. ([C8](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 327 |
| **3.2.6** | تحقق من تكوين متجه تهيئة التشفير encryption initialization vector والنصوص المشفرة  cipher و block modes  بشكل آمن وباستخدام أحدث التوصيات. | | ✓ | ✓ | 326 |
| **4.2.6** | تحقق من أن الأرقام العشوائية أو التشفير أو خوارزميات التجزئة أو أطوال المفاتيح أو الدورات rounds أو النصوص المشفرة ciphers أو الأنماط ، يمكن إعادة تكوينها أو ترقيتها أو تبديلها في أي وقت للحماية من فواصل التشفير cryptographic breaks. ([C8](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 326 |
| **5.2.6** | تحقق من أنماط الكتلة غير الآمنة insecure block modes  المعروفة (مثل ECB ، وما إلى ذلك) ، وأنماط الحشو padding modes (مثل PKCS # 1 v1.5 ، وما إلى ذلك) ، وخوارزميات التشفير ذات أحجام الكتل الصغيرة ciphers with small block sizes  (مثل Triple-DES ، و Blowfish ، وما إلى ذلك) ، وخوارزميات التجزئة الضعيفة (مثل MD5 و SHA1 وما إلى ذلك) لا يتم استخدامها ما لم يكن ذلك مطلوبًا للتوافق مع الإصدارات السابقة. | | ✓ | ✓ | 326 |
| **6.2.6** | تحقق من أن nonces ومتجهات التهيئة initialization vectors وأرقام الاستخدام الفردي الأخرى other single use numbers لا تستخدم الأرقام أكثر من مرة في مفتاح تشفير معين. يجب أن تكون طريقة التوليد مناسبة للخوارزمية المستخدمة. | | ✓ | ✓ | 326 |
| **7.2.6** | تحقق من مصادقة البيانات المشفرة عبر التوقيعات signatures  أو أنماط التشفير المصدق عليها authenticated cipher modes أو HMAC لضمان عدم تغيير النص المشفر من قبل طرف غير مصرح له. | | | ✓ | 326 |
| **8.2.6** | تحقق من أن جميع عمليات التشفير تتم في وقت ثابت ، مع عدم وجود عمليات "ماس كهربائي short-circuit " في المقارنات أو الحسابات أو القيم الراجعة returns ، لتجنب تسريب المعلومات. | | | ✓ | 385 |

## ق3.6 القيم العشوائية

إنه من الصعب توليد الأرقام الزائفة العشوائية الحقيقية True Pseudo-random Number Generation (PRNG) بطريقة صحيحة. بشكل عام ، المصادر الجيدة للإنتروبيا داخل النظام سوف يتم نفاذها سريعًا إذا تم الإفراط في استخدامها ، ولكن المصادر ذات العشوائية الأقل يمكن أن تؤدي إلى مفاتيح وأسرار يمكن التنبؤ بها.

| # | التوصيف | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **1.3.6** | تحقق من أن جميع الأرقام العشوائية وأسماء الملفات العشوائية ومعرفات GUID العشوائية والسلاسل العشوائية يتم توليدها باستخدام مولد الأرقام العشوائي الآمن المشفر المعتمد من وحدة التشفير cryptographic module's approved cryptographically secure random number generator عندما يكون الهدف هو عدم تخمين هذه القيم العشوائية من قبل المهاجم. | | ✓ | ✓ | 338 |
| **2.3.6** | تحقق من إنشاء المعرفات الفريدة العمومية العشوائية GUIDs باستخدام خوارزمية GUID v4 ، ومولد الأرقام العشوائي الزائف الآمن Cryptographically-secure Pseudo-random Number Generator (CSPRNG). يمكن التنبؤ بمعرفات GUIDs التي تم توليدها باستخدام مولدات الأرقام العشوائية الزائفة الأخرى. | | ✓ | ✓ | 338 |
| **3.3.6** | تحقق من إنشاء أرقام عشوائية مع الانتروبيا المناسبة حتى عندما يكون التطبيق تحت حمل ثقيل heavy load ، أو أن التطبيق يتدهور بطريقة آمنة في مثل هذه الظروف. | | | ✓ | 338 |

## ق4.6 إدارة السر

على الرغم من أن هذا القسم لا يتم اختباره بسهولة ، إلا أن المطورين يجب أن يعتبروا هذا القسم بأكمله إلزاميًا على الرغم من أن L1 مفقود من معظم العناصر.

| # | التوصيف | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **1.4.6** | تحقق من استخدام حل إدارة الأسرار secrets management solution  مثل خزنة المفاتيح لإنشاء الأسرار وتخزينها والتحكم في الوصول إليها وتدميرها بشكل آمن. ([C8](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 798 |
| **2.4.6** | تحقق من عدم تعرض المادة الرئيسية للتطبيق ولكن بدلاً من ذلك تستخدم وحدة أمان معزولة مثل vault لعمليات التشفير. ([C8](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 320 |

## المراجع

لمزيد من المعلومات، يمكن أيضاً الاطلاع على:

* [OWASP Testing Guide 4.0: Testing for weak Cryptography](https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/09-Testing_for_Weak_Cryptography/README.html)
* [OWASP Cheat Sheet: Cryptographic Storage](https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html)
* [FIPS 140-2](https://csrc.nist.gov/publications/detail/fips/140/2/final)
