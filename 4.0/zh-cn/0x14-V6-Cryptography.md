# V6 存储密码学

## 控制目标

确保经过验证的应用程序满足以下高级要求：

* 所有加密模块以安全的方式失效，并且正确处理错误。
* 使用合适的随机数发生器。
* 密钥访问被安全地管理。

## V6.1 数据分类

最重要的资产是由应用程序处理、存储或传输的数据。始终执行隐私影响评估，对任何存储数据的数据保护需求进行正确分类。

| # | 说明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **6.1.1** | 验证受监管的私人数据在静止状态下是否被加密存储，如个人身份信息（PII）、敏感个人信息或经评估可能受制于欧盟GDPR的数据。 | | ✓ | ✓ | 311 |
| **6.1.2** | 验证受监管的健康数据在静止状态下是否被加密存储，如医疗记录、医疗设备详情或去匿名化的研究记录。 | | ✓ | ✓ | 311 |
| **6.1.3** | 验证受监管的金融数据在静止状态下是否被加密存储，如金融账户、违约或信用记录、税务记录、工资记录、受益人或去匿名化的市场或研究记录。 | | ✓ | ✓ | 311 |

## V6.2  算法

密码学的最新进展意味着以前安全的算法和密钥长度不再安全或足以保护数据。因此，应该可以改变算法。

虽然这一部分不容易进行渗透测试，但开发人员应该把这一整节视为强制性的，即使在大多数项目中 L1 都没有要求。

| # | 说明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **6.2.1** | 验证所有的加密模块即使在故障时也是安全的，并且处理错误的方式不会使Padding Oracle攻击得逞。 | ✓ | ✓ | ✓ | 310 |
| **6.2.2** | 验证使用业界认可或政府批准的加密算法、模式和库，而不是自定义编码的加密技术。 ([C8](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 327 |
| **6.2.3** | 验证加密初始化向量、密码配置和分组模式是否使用最新建议进行安全配置。 | | ✓ | ✓ | 326 |
| **6.2.4** | 验证随机数、加密或散列算法、密钥长度、轮次、密码或模式，可以在任何时候重新配置、升级或交换，以防止密码中断。 ([C8](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 326 |
| **6.2.5** | 验证不使用已知不安全的分组模式（如ECB等）、填充模式（如PKCS#1 v1.5等）、小块大小的密码（如Triple-DES、Blowfish等）和弱散列算法（如MD5、SHA1等），除非需要向后兼容。 | | ✓ | ✓ | 326 |
| **6.2.6** | 验证随机数、初始化向量和其他一次性使用的数字，不得与特定的加密密钥使用超过一次。生成方法必须适合所使用的算法。 | | ✓ | ✓ | 326 |
| **6.2.7** | 验证加密数据是否通过签名、认证的密码模式或 HMAC 进行身份验证，以确保密文不会被未经授权的一方更改。 | | | ✓ | 326 |
| **6.2.8** | 验证所有的密码操作都是恒定时间的，在比较、计算或返回中没有“短路”操作，以避免信息泄漏。 | | | ✓ | 385 |

## V6.3 随机值

真正的伪随机数生成（PRNG）很难实现。通常，如果过度使用，系统内良好的熵源不但很快耗尽，而且随机性较小的源会导致可预测的密钥和秘密。

| # | 说明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **6.3.1** | 验证所有的随机数、随机文件名、随机GUID和随机字符串，都是使用加密模块认可的加密安全随机数生成器生成的，而这些随机值旨在不被攻击者猜测。 | | ✓ | ✓ | 338 |
| **6.3.2** | 验证是否使用 GUID v4 算法和加密安全伪随机数生成器（CSPRNG）创建了随机 GUID。使用其他伪随机数生成器创建的 GUID 可能是可预测的。 | | ✓ | ✓ | 338 |
| **6.3.3** | 验证应用程序即使在处于高负载下时也使用适当的熵创建随机数，或者应用程序在这种情况下优雅地降级。 | | | ✓ | 338 |

## V6.4 密钥管理

虽然这一部分不容易进行渗透测试，但开发人员应将整个部分视为强制性的，即使大多数项目中都缺少 L1 的要求。

| # | 说明 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---:| :---: | :---: |
| **6.4.1** | 验证秘密管理解决方案，如钥匙库，用于安全地创建、存储、控制对秘密的访问和销毁。 ([C8](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 798 |
| **6.4.2** | 验证密钥材料是否未暴露给应用程序，而是使用一个隔离的安全模块（如保险库）进行加密操作。 ([C8](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 320 |

## 参考文献

有关更多信息，请参阅：

* [OWASP Testing Guide 4.0: Testing for weak Cryptography](https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/09-Testing_for_Weak_Cryptography/README.html)
* [OWASP Cheat Sheet: Cryptographic Storage](https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html)
* [FIPS 140-2](https://csrc.nist.gov/publications/detail/fips/140/2/final)
