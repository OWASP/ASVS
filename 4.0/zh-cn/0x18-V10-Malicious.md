# V10 恶意代码

## 控制目标

确保代码满足以下高级要求：

* 恶意活动得到安全和适当的处理，不会影响应用程序的其余部分。
* 没有定时炸弹或其他基于时间的攻击。
* 不会向恶意或未经授权的目的地“打电话回家”。
* 没有后门、复活节彩蛋、Salami攻击、rootkit 或攻击者可以控制的未授权代码。

发现恶意代码是否定的证明，这是不可能被充分验证的。应尽最大努力，确保代码没有固有的恶意代码或不需要的功能。

## V10.1 代码完整性

对恶意代码的最佳防御是“信任，但要验证”。在许多司法管辖区，将未经授权或恶意的代码片段引入代码，通常是刑事犯罪。策略和过程应明确对恶意代码的制裁。

首席开发人员应该定期检查代码签入，特别是那些可能去访问时间、I/O或网络功能的代码签入。

| # | 描述 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **10.1.1** | 验证是否使用了代码分析工具，可以检测潜在的恶意代码，如时间函数、不安全的文件操作和网络连接。 | | | ✓ | 749 |

## V10.2 恶意代码搜索

恶意代码极为罕见，难以检测。手动逐行审查代码可以帮助寻找逻辑炸弹，但即使是最有经验的代码审查员也很难找到恶意代码，哪怕事先知道它们的存在。

如果不能完全接触到源代码，包括第三方库，就不可能遵守本节的规定。

| # | 描述 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **10.2.1** | 验证应用程序的源代码和第三方库不包含未经授权的回连或数据收集功能。如果存在这样的功能，在收集任何数据之前，要获得用户的操作许可。 | | ✓ | ✓ | 359 |
| **10.2.2** | 验证应用程序不会对隐私相关的功能或传感器（例如联系人、摄像头、麦克风或位置）要求不必要或过度的权限。 | | ✓ | ✓ | 272 |
| **10.2.3** | 验证应用程序的源代码和第三方库不包含后门，如硬编码或额外的未记录的账户或密钥、代码混淆、未记录的二进制blobs、rootkits或反调试、不安全的调试特性，或其他过时、不安全或隐藏的功能，一旦被发现可能会被恶意使用。 | | | ✓ | 507 |
| **10.2.4** | 通过搜索日期和时间相关函数，来验证应用程序源代码和第三方库不包含时间炸弹。 | | | ✓ | 511 |
| **10.2.5** | 验证应用程序源代码和第三方库不包含恶意代码，例如salami攻击、逻辑绕过或逻辑炸弹。 | | | ✓ | 511 |
| **10.2.6** | 验证应用程序的源代码和第三方库不包含复活节彩蛋或任何其他潜在的冗余功能。 | | | ✓ | 507 |

## V10.3 应用程序完整性

应用程序被部署后，恶意代码仍然可以被插入。应用程序需要保护自己免受常见的攻击，例如执行来自不受信任来源的未签名代码或子域接管。

本节内容的实现，很可能是操作性和持续性的。

| # | 描述 | L1 | L2 | L3 | CWE |
| :---: | :--- | :---: | :---: | :---: | :---: |
| **10.3.1** | 验证如果应用程序具有客户端或服务器自动更新功能，则应通过安全通道获得更新，并进行数字签名。更新代码必须在安装或执行更新之前验证更新的数字签名。 | ✓ | ✓ | ✓ | 16 |
| **10.3.2** | 验证应用程序是否采用了完整性保护，如代码签名或子资源完整性。应用程序不得从不受信任的来源加载或执行代码，例如从不可信任的来源或互联网加载模块、插件、代码或库。 | ✓ | ✓ | ✓ | 353 |
| **10.3.3** | 如果应用程序依赖 DNS 条目或 DNS 子域，例如过期的域名、过时的 DNS 指针或 CNAME、公共源代码库中过期的项目或临时的云API接口、serverless功能或存储桶（*autogen-bucket-id*.cloud.example.com）或类似情况，则验证该应用程序是否具有防止子域接管的措施。保护措施可以包括确保定期检查应用程序使用的DNS名称是否过期或改变。 | ✓ | ✓ | ✓ | 350 |

## 参考文献

有关更多信息，请参阅：

* [Hostile Subdomain Takeover, Detectify Labs](https://labs.detectify.com/2014/10/21/hostile-subdomain-takeover-using-herokugithubdesk-more/)
* [Hijacking of abandoned subdomains part 2, Detectify Labs](https://labs.detectify.com/2014/12/08/hijacking-of-abandoned-subdomains-part-2/)
